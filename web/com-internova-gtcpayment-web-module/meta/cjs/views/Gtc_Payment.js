"use strict";var __extends=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function __(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),__decorate=this&&this.__decorate||function(e,t,r,a){var n,o=arguments.length,i=o<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,r):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,a);else for(var l=e.length-1;l>=0;l--)(n=e[l])&&(i=(o<3?n(i):o>3?n(t,r,i):n(t,r))||i);return o>3&&i&&Object.defineProperty(t,r,i),i},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},__awaiter=this&&this.__awaiter||function(e,t,r,a){return new(r||(r=Promise))(function(n,o){function fulfilled(e){try{step(a.next(e))}catch(t){o(t)}}function rejected(e){try{step(a.throw(e))}catch(t){o(t)}}function step(e){e.done?n(e.value):function adopt(e){return e instanceof r?e:new r(function(t){t(e)})}(e.value).then(fulfilled,rejected)}step((a=a.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){var r,a,n,o,i={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function verb(o){return function(l){return function step(o){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,a&&(n=2&o[0]?a.return:o[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,o[1])).done)return n;switch(a=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,a=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(n=(n=i.trys).length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){i.label=o[1];break}if(6===o[0]&&i.label<n[1]){i.label=n[1],n=o;break}if(n&&i.label<n[2]){i.label=n[2],i.ops.push(o);break}n[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(l){o=[6,l],a=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Gtc_Payment=void 0;var AbstractView_1=require("sabre-ngv-app/app/AbstractView"),LayerService_1=require("sabre-ngv-core/services/LayerService"),Template_1=require("sabre-ngv-core/decorators/classes/view/Template"),pqFare_1=require("../model/pqFare"),ccData_1=require("../model/ccData"),IAreaService_1=require("sabre-ngv-app/app/services/impl/IAreaService"),RestModel_1=require("../model/RestModel"),Context_1=require("../Context"),CheckTotal_1=require("./CheckTotal"),remark_1=require("../model/remark"),SabreController_1=require("../controllers/SabreController"),Gtc_Payment=function(e){function Gtc_Payment(t,r){var a=e.call(this,t)||this;return a.status=[],a.vendors=[{code:"AX"},{code:"VI"},{code:"CA"}],a.totalPax=0,a.updateRmks=[],a.pqFareList=[],a.creditCardList=[],a.getReservation(r),a}return __extends(Gtc_Payment,e),Gtc_Payment.prototype.initialize=function(t){e.prototype.addDomEvents.call(this,{"change #selectPq":"loadAmount","change #creditCards":"loadExpiration","change #markUpFee":"updateTotal","change #amt":"updateTotal","change #additional":"updateTotal","change #tktFee":"updateTotal"}),e.prototype.initialize.call(this,t)},Gtc_Payment.prototype.getReservation=function(e){var t,r,a,n,o=this;(0,Context_1.getService)(SabreController_1.SabreController);if(e){var i=e.Data,l=null===(t=null==e?void 0:e.Data)||void 0===t?void 0:t.RecordLocators[0].Id,d=i.Passengers.Passenger.length;this.totalPax=d;var s,c,u,m=new Date,p=m.getFullYear().toString(),v=m.getMonth()+1,f=m.getDate(),h=f<10?"0"+f.toString():f.toString(),y=v<10?"0"+v.toString():v.toString(),g=l+p[2]+p[3]+y+h,_="",I=0,x=0,k=i.Passengers.Passenger[0].GivenName+" "+i.Passengers.Passenger[0].Surname;if(null===(r=i.PriceQuotes)||void 0===r?void 0:r.PriceQuote)(u=i.PriceQuotes.PriceQuote).length&&u.forEach(function(e){if("GBP"==e.Taxes.TotalTax.Currency){var t=new pqFare_1.pqFare,r=e.Id.toString();t.item=r[r.length-1],t.total=e.Total.Amount.Amount,t.taxes=e.Taxes.TotalTax.Amount,o.pqFareList.push(t)}});if(null===(a=i.FormOfPayments)||void 0===a?void 0:a.FormOfPayment)(u=i.FormOfPayments.FormOfPayment).length&&u.forEach(function(e){var t=new ccData_1.ccData;if(t.code=e.CreditCard.CreditCardCode,t.cardMasked=t.code+e.CreditCard.CreditCardNumber,t.cardMasked){for(var r="",a=t.cardMasked.length-4;a<t.cardMasked.length;a++)r+=t.cardMasked[a].toString();t.last4=r}t.year=e.CreditCard.ExpirationYear[2]+e.CreditCard.ExpirationYear[3],t.month=e.CreditCard.ExpirationMonth,o.creditCardList.push(t)});if(null===(n=i.Remarks)||void 0===n?void 0:n.Remark){var E=i.Remarks.Remark;E.length&&E.forEach(function(e){if("Invoice"==e.Type){var t=e.Text.split("MKUP/");if(t[1]){var r=t[1].split("/");s=r[1],I+=parseFloat(s)}var a,n=e.Text.split("TKTFEE/");if(n[1]?c=n[1]:(n=e.Text.split("FEE/"))[1]&&(_=n[1]),e.Text.split("CM-")[1])(a=new remark_1.remark).Type="Itinerary",a.Id=e.Source.Id.toString(),a.Text=e.Text,a.Code="CM",o.updateRmks.push(a);if(e.Text.split("PAYMENT/")[1])(a=new remark_1.remark).Type="Itinerary",a.Id=e.Source.Id.toString(),a.Text=e.Text,a.Code="PAY",o.updateRmks.push(a)}})}c&&(x=d*parseFloat(c)),_&&(x=parseFloat(_));var b=I+x;this.getModel().set("markUpFee",I.toFixed(2)),this.getModel().set("tktFee",x.toFixed(2)),this.getModel().set("selectPq",this.pqFareList),this.getModel().set("creditCards",this.creditCardList),this.getModel().set("name",k),this.getModel().set("refId",g),this.getModel().set("total",b.toFixed(2)+" GBP"),this.getModel().set("vendors",this.vendors),this.render()}else{(0,Context_1.getService)(IAreaService_1.IAreaService).showBanner("Error","There is no active PNR..."),(0,Context_1.getService)(LayerService_1.LayerService).clearLayer()}},Gtc_Payment.prototype.loadAmount=function(e){var t=this,r=this.$("#selectPq").children("option:selected").val();e.target&&(this.pqFareList.forEach(function(e){e.item==r&&(document.getElementById("amt").value=e.total.toString(),t.updateTotal())}),$("#selectPq").val(r))},Gtc_Payment.prototype.loadExpiration=function(e){var t=this.$("#creditCards").children("option:selected").val();e.target&&(this.creditCardList.forEach(function(e){if(e.cardMasked==t){document.getElementById("cardInUse").value=t;var r=e.month+"/"+e.year;document.getElementById("expiration").value=r}}),$("#creditCards").val(t));var r=document.getElementById("cardInUse");"addCC"==t?(document.getElementById("cardInUse").value="",document.getElementById("expiration").value="",document.getElementById("vendor").removeAttribute("disabled"),r.removeAttribute("disabled")):r.setAttribute("disabled","")},Gtc_Payment.prototype.updateTotal=function(e){var t=0,r=0,a=0,n=0;document.getElementById("markUpFee").value&&(t=parseFloat(document.getElementById("markUpFee").value),document.getElementById("markUpFee").value=t.toFixed(2)),document.getElementById("amt").value&&(r=parseFloat(document.getElementById("amt").value),document.getElementById("amt").value=r.toFixed(2)),document.getElementById("additional").value&&(a=parseFloat(document.getElementById("additional").value),document.getElementById("additional").value=a.toFixed(2)),document.getElementById("tktFee").value&&(n=parseFloat(document.getElementById("tktFee").value),document.getElementById("tktFee").value=n.toFixed(2));var o=t+r+a+n;document.getElementById("total").value=o.toFixed(2)+" GBP"},Gtc_Payment.prototype.selfNextAction=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this.InputValidator()&&this.execute(),[2]})})},Gtc_Payment.prototype.execute=function(){var e,t=document.getElementById("markUpFee").value,r=document.getElementById("name").value,a=document.getElementById("tktFee").value,n=document.getElementById("amt").value,o=document.getElementById("additional").value,i=document.getElementById("total").value,l=this.$("#creditCards").children("option:selected").val(),d=this.$("#test").children("option:selected").val(),s="";if("addCC"==l){e=this.$("#vendor").children("option:selected").val();for(var c=(l=document.getElementById("cardInUse").value).length-4;c<l.length;c++)s+=l[c].toString()}else{var u=this.creditCardList.filter(function(e){return e.cardMasked==l});s=u[0].last4,e=u[0].code}var m=document.getElementById("refId").value,p=document.getElementById("expiration").value,v=p.split("/")[0],f=p.split("/")[1],h={markUpFee:t,fee:a,name:r,pqAmt:n,additional:o,total:i,fullCard:l,expMonth:v,expYear:f,card4:s,option:d,ccCode:e,refId:m,UpdateRmk:this.updateRmks};console.log("pack",h);(0,Context_1.getService)(LayerService_1.LayerService).showInModal(new CheckTotal_1.CheckTotal({model:new RestModel_1.RestModel},h),{title:"Confirmation",actions:[{className:"app.common.views.Button",caption:"Cancel",actionName:"cancel",type:"secondary"},{className:"app.common.views.Button",caption:"Back",actionName:"back",type:"secondary"},{className:"app.common.views.Button",caption:"Add Remarks",actionName:"next",type:"success"}]},{display:"areaView"})},Gtc_Payment.prototype.InputValidator=function(){var e=!0,t=document.getElementById("total").value;if(parseFloat(t.split("GBP")[0])>0){this.fieldOk("total");for(var r=document.querySelectorAll("[required]"),a=0;a<r.length;a++){var n=r[a].id,o=document.getElementById(n).value;if("creditCards"==n&&"ccNoSelected"==o){this.errorOnField(n,"Field cannot be empty or blank"),e=!1;break}if("creditCards"==n&&"addCC"==o){if(1==this.status.creditCards&&this.fieldOk("creditCards"),"noVendor"==document.getElementById("vendor").value){this.status.vendor=!0,this.errorOnField("vendor","Select one"),e=!1;break}this.fieldOk("vendor");var i=document.getElementById("cardInUse").value;if(16==i.length&&1==this.status.cardInUse)this.fieldOk("cardInUse");else{if(i.length>16){this.errorOnField("cardInUse","Maximum 16 numbers"),e=!1;break}if(i.length<=15){this.status.cardInUse=!0,this.errorOnField("cardInUse","Minimum 16 numbers"),e=!1;break}}}else if("name"==n){var l=document.getElementById("name").value;if(!l){this.errorOnField("name","Name is mandatory"),e=!1;break}l&&1==this.status.name&&this.fieldOk("creditCards")}else if("name"==n){var d=document.getElementById("name").value;if(!d){this.errorOnField("name","Name is mandatory"),e=!1;break}d&&1==this.status.name&&this.fieldOk("creditCards")}else if("expiration"==n){if(!document.getElementById("expiration").value){this.errorOnField("expiration","Expiration is mandatory"),e=!1;break}var s=new Date,c=s.getFullYear().toString(),u=s.getMonth()+1,m=parseFloat(c[2]+c[3]),p=document.getElementById("expiration").value,v=parseFloat(p.split("/")[0]),f=parseFloat(p.split("/")[1]);if(isNaN(v)||isNaN(f)||v>12||v<1||f<m||f==m&&v<u){this.errorOnField("expiration","MM/YY like: 05/27"),e=!1;break}this.fieldOk("expiration")}}}else this.errorOnField("total","Must be greater than 0"),e=!1;return e},Gtc_Payment.prototype.errorOnField=function(e,t){document.getElementById(e+"Error").innerText=t,document.getElementById(e+"Div").classList.add("has-error"),document.getElementById(e).focus(),this.status[e]=!0},Gtc_Payment.prototype.fieldOk=function(e){1==this.status[e]&&(document.getElementById(e+"Div").classList.remove("has-error"),document.getElementById(e+"Error").innerText="",this.status[e]=!1)},Gtc_Payment=__decorate([(0,Template_1.Template)("com-internova-gtcpayment-web-module:Gtc_Payment"),__metadata("design:paramtypes",[Object,Object])],Gtc_Payment)}(AbstractView_1.AbstractView);exports.Gtc_Payment=Gtc_Payment;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9jb2RlL3ZpZXdzL0d0Y19QYXltZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJ1aUZBQUEsSUFBQSxlQUFBLFFBQUEsa0NBQ0EsZUFBQSxRQUFBLHdDQUNBLFdBQUEsUUFBQSxtREFDQSxTQUFBLFFBQUEsbUJBQ0EsU0FBQSxRQUFBLG1CQUNBLGVBQUEsUUFBQSxnREFPQSxZQUFBLFFBQUEsc0JBQ0EsVUFBQSxRQUFBLGNBQ0EsYUFBQSxRQUFBLGdCQUNBLFNBQUEsUUFBQSxtQkFDQSxrQkFBQSxRQUFBLGtDQUdBLFlBQUEsU0FBQSxHQUVJLFNBQUEsWUFBWSxFQUErQixHQUEzQyxJQUFBLEVBQ0ksRUFBQSxLQUFBLEtBQU0sSUFBUSxZQUdYLEVBQUEsT0FBUyxHQUVULEVBQUEsUUFBVSxDQUFDLENBQUUsS0FBTSxNQUFRLENBQUUsS0FBTSxNQUFRLENBQUUsS0FBTSxPQUNuRCxFQUFBLFNBQW1CLEVBQ25CLEVBQUEsV0FBdUIsR0FDdkIsRUFBQSxXQUF1QixHQUN2QixFQUFBLGVBQTJCLEdBUjlCLEVBQUssZUFBZSxLQTJhNUIsT0EvYWlDLFVBQUEsWUFBQSxHQWE3QixZQUFBLFVBQUEsV0FBQSxTQUFXLEdBQ1AsRUFBQSxVQUFNLGFBQVksS0FBQSxLQUFDLENBQ2YsbUJBQW9CLGFBQ3BCLHNCQUF1QixpQkFDdkIsb0JBQXFCLGNBQ3JCLGNBQWUsY0FDZixxQkFBc0IsY0FDdEIsaUJBQWtCLGdCQUV0QixFQUFBLFVBQU0sV0FBVSxLQUFBLEtBQUMsSUFHckIsWUFBQSxVQUFBLGVBQUEsU0FBZSxHQUFmLFlBQUEsRUFBQSxNQUVnQyxFQUFBLFVBQUEsWUFBVyxrQkFBQSxpQkFDdkMsR0FBSyxFQUlFLENBQ0gsSUFBSSxFQUFVLEVBQVEsS0FDbEIsRUFBeUIsUUFBYixFQUFBLE1BQUEsT0FBTyxFQUFQLEVBQVMsWUFBSSxJQUFBLE9BQUEsRUFBQSxFQUFFLGVBQWUsR0FBTyxHQUNqRCxFQUFXLEVBQVEsV0FBVyxVQUFVLE9BQzVDLEtBQUss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R0FBVSxjQUFOLEVBQW9CLENBRTNCLElBRG9DLFNBQVMsZUFBZSxjQUFlLE1BQzFELENBQ2IsS0FBSyxhQUFhLGFBQWMsMkJBQ2hDLEdBQVEsRUFDUixNQUtBLElBQUksRUFBTyxJQUFJLEtBQ1gsRUFBUSxFQUFLLGNBQWMsV0FDM0IsRUFBWSxFQUFLLFdBQWEsRUFDOUIsRUFBUSxXQUFXLEVBQU0sR0FBSyxFQUFNLElBQ3BDLEVBQXlCLFNBQVMsZUFBZSxjQUFlLE1BQ2hFLEVBQVcsV0FBVyxFQUFJLE1BQU0sS0FBSyxJQUNyQyxFQUFVLFdBQVcsRUFBSSxNQUFNLEtBQUssSUFJeEMsR0FBSSxNQUFNLElBQWEsTUFBTSxJQUFZLEVBQVcsSUFBTSxFQUFXLEdBQUssRUFBVSxHQUFVLEdBQVcsR0FBUyxFQUFXLEVBQVksQ0FDckksS0FBSyxhQUFhLGFBQWMscUJBQ2hDLEdBQVEsRUFDUixNQUVBLEtBQUssUUFBUSxxQkFNN0IsS0FBSyxhQUFhLFFBQVMsMEJBQzNCLEdBQVEsRUFzQlosT0FBTyxHQUdILFlBQUEsVUFBQSxhQUFSLFNBQXFCLEVBQVksR0FDWixTQUFTLGVBQWUsRUFBSyxTQUFVLFVBQVksRUFDbkQsU0FBUyxlQUFlLEVBQUssT0FBUSxVQUFVLElBQUksYUFDakQsU0FBUyxlQUFlLEdBQUssUUFDaEQsS0FBSyxPQUFPLElBQU0sR0FHZCxZQUFBLFVBQUEsUUFBUixTQUFnQixHQUNXLEdBQW5CLEtBQUssT0FBTyxLQUNLLFNBQVMsZUFBZSxFQUFLLE9BQVEsVUFBVSxPQUFPLGFBQ3RELFNBQVMsZUFBZSxFQUFLLFNBQVUsVUFBWSxHQUNwRSxLQUFLLE9BQU8sSUFBTSxJQTVhakIsWUFBVyxXQUFBLEVBRHZCLEVBQUEsV0FBQSxVQUFTLG9HQUNHLGFBQWIsQ0FBaUMsZUFBQSxjQUFwQixRQUFBLFlBQUEiLCJmaWxlIjoiR3RjX1BheW1lbnQuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBYnN0cmFjdFZpZXcgfSBmcm9tIFwic2FicmUtbmd2LWFwcC9hcHAvQWJzdHJhY3RWaWV3XCI7XG5pbXBvcnQgeyBMYXllclNlcnZpY2UgfSBmcm9tIFwic2FicmUtbmd2LWNvcmUvc2VydmljZXMvTGF5ZXJTZXJ2aWNlXCI7XG5pbXBvcnQgeyBUZW1wbGF0ZSB9IGZyb20gXCJzYWJyZS1uZ3YtY29yZS9kZWNvcmF0b3JzL2NsYXNzZXMvdmlldy9UZW1wbGF0ZVwiO1xuaW1wb3J0IHsgcHFGYXJlIH0gZnJvbSBcIi4uL21vZGVsL3BxRmFyZVwiO1xuaW1wb3J0IHsgY2NEYXRhIH0gZnJvbSBcIi4uL21vZGVsL2NjRGF0YVwiO1xuaW1wb3J0IHsgSUFyZWFTZXJ2aWNlIH0gZnJvbSAnc2FicmUtbmd2LWFwcC9hcHAvc2VydmljZXMvaW1wbC9JQXJlYVNlcnZpY2UnO1xuaW1wb3J0IHsgQWJzdHJhY3RBY3Rpb25PcHRpb25zIH0gZnJvbSBcInNhYnJlLW5ndi1hcHAvYXBwL2NvbW1vbi92aWV3cy9BYnN0cmFjdEFjdGlvbk9wdGlvbnNcIjtcbmltcG9ydCB7IEFic3RyYWN0Vmlld09wdGlvbnMgfSBmcm9tICdzYWJyZS1uZ3YtYXBwL2FwcC9BYnN0cmFjdFZpZXdPcHRpb25zJztcbmltcG9ydCB7IENvbW1hbmRNZXNzYWdlUmVzZXJ2YXRpb25ScyB9IGZyb20gJ3NhYnJlLW5ndi1wb3MtY2RtL3Jlc2VydmF0aW9uJztcbmltcG9ydCB7IFJlc3RBcGlTZXJ2aWNlIH0gZnJvbSBcInNhYnJlLW5ndi1jb21tdW5pY2F0aW9uL3NlcnZpY2VzL1Jlc3RBcGlTZXJ2aWNlXCI7XG5pbXBvcnQgeyBBdXRoVG9rZW5UeXBlIH0gZnJvbSBcInNhYnJlLW5ndi1hcHAvYXBwL3NlcnZpY2VzL2ltcGwvQXV0aFRva2VuVHlwZVwiO1xuaW1wb3J0IHsgSHR0cE1ldGhvZCB9IGZyb20gXCJzYWJyZS1uZ3YtYXBwL2FwcC9zZXJ2aWNlcy9pbXBsL0h0dHBNZXRob2RcIjtcbmltcG9ydCB7IFJlc3RNb2RlbCB9IGZyb20gXCIuLi9tb2RlbC9SZXN0TW9kZWxcIjtcbmltcG9ydCB7IGdldFNlcnZpY2UgfSBmcm9tIFwiLi4vQ29udGV4dFwiO1xuaW1wb3J0IHsgQ2hlY2tUb3RhbCB9IGZyb20gXCIuL0NoZWNrVG90YWxcIjtcbmltcG9ydCB7IHJlbWFyayB9IGZyb20gXCIuLi9tb2RlbC9yZW1hcmtcIjtcbmltcG9ydCB7IFNhYnJlQ29udHJvbGxlciB9IGZyb20gXCIuLi9jb250cm9sbGVycy9TYWJyZUNvbnRyb2xsZXJcIjtcblxuQFRlbXBsYXRlKCdjb20taW50ZXJub3ZhLWd0Y3BheW1lbnQtd2ViLW1vZHVsZTpHdGNfUGF5bWVudCcpXG5leHBvcnQgY2xhc3MgR3RjX1BheW1lbnQgZXh0ZW5kcyBBYnN0cmFjdFZpZXc8UmVzdE1vZGVsPiB7XG5cbiAgICBjb25zdHJ1Y3RvcihvcHRpb25zPzogQWJzdHJhY3RWaWV3T3B0aW9ucywgcmVzZXJ2YXRpb24/OiBDb21tYW5kTWVzc2FnZVJlc2VydmF0aW9uUnMpIHtcbiAgICAgICAgc3VwZXIob3B0aW9ucyk7XG4gICAgICAgIHRoaXMuZ2V0UmVzZXJ2YXRpb24ocmVzZXJ2YXRpb24pO1xuICAgIH1cbiAgICBwdWJsaWMgc3RhdHVzID0gW107XG5cbiAgICBwdWJsaWMgdmVuZG9ycyA9IFt7IGNvZGU6IFwiQVhcIiB9LCB7IGNvZGU6IFwiVklcIiB9LCB7IGNvZGU6IFwiQ0FcIiB9XVxuICAgIHB1YmxpYyB0b3RhbFBheDogbnVtYmVyID0gMDtcbiAgICBwdWJsaWMgdXBkYXRlUm1rczogcmVtYXJrW10gPSBbXTtcbiAgICBwdWJsaWMgcHFGYXJlTGlzdDogcHFGYXJlW10gPSBbXTtcbiAgICBwdWJsaWMgY3JlZGl0Q2FyZExpc3Q6IGNjRGF0YVtdID0gW107XG4gICAgaW5pdGlhbGl6ZShvcHRpb25zOiBBYnN0cmFjdEFjdGlvbk9wdGlvbnMpOiB2b2lkIHtcbiAgICAgICAgc3VwZXIuYWRkRG9tRXZlbnRzKHtcbiAgICAgICAgICAgICdjaGFuZ2UgI3NlbGVjdFBxJzogJ2xvYWRBbW91bnQnLFxuICAgICAgICAgICAgJ2NoYW5nZSAjY3JlZGl0Q2FyZHMnOiAnbG9hZEV4cGlyYXRpb24nLFxuICAgICAgICAgICAgJ2NoYW5nZSAjbWFya1VwRmVlJzogJ3VwZGF0ZVRvdGFsJyxcbiAgICAgICAgICAgICdjaGFuZ2UgI2FtdCc6ICd1cGRhdGVUb3RhbCcsXG4gICAgICAgICAgICAnY2hhbmdlICNhZGRpdGlvbmFsJzogJ3VwZGF0ZVRvdGFsJyxcbiAgICAgICAgICAgICdjaGFuZ2UgI3RrdEZlZSc6ICd1cGRhdGVUb3RhbCdcbiAgICAgICAgfSk7XG4gICAgICAgIHN1cGVyLmluaXRpYWxpemUob3B0aW9ucyk7XG4gICAgfVxuXG4gICAgZ2V0UmVzZXJ2YXRpb24oZnVsbFBOUj86IENvbW1hbmRNZXNzYWdlUmVzZXJ2YXRpb25Scyk6IHZvaWQge1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhcImNjTnVtXCIsIHRoaXMuY2NOdW0pO1xuICAgICAgICBsZXQgZ2V0cmVzZXJ2YXRpb25wcm9taXNlID0gZ2V0U2VydmljZShTYWJyZUNvbnRyb2xsZXIpO1xuICAgICAgICBpZiAoIWZ1bGxQTlIpIHtcbiAgICAgICAgICAgIGNvbnN0IGFyZWFTZXJ2aWNlOiBJQXJlYVNlcnZpY2UgPSBnZXRTZXJ2aWNlKElBcmVhU2VydmljZSk7XG4gICAgICAgICAgICBhcmVhU2VydmljZS5zaG93QmFubmVyKCdFcnJvcicsICdUaGVyZSBpcyBubyBhY3RpdmUgUE5SLi4uJyk7XG4gICAgICAgICAgICBnZXRTZXJ2aWNlKExheWVyU2VydmljZSkuY2xlYXJMYXllcigpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbGV0IHBuckRhdGEgPSBmdWxsUE5SLkRhdGE7XG4gICAgICAgICAgICBsZXQgcG5yUmVjbG9jID0gZnVsbFBOUj8uRGF0YT8uUmVjb3JkTG9jYXRvcnNbMF1bJ0lkJ107XG4gICAgICAgICAgICBsZXQgdG90YWxQYXggPSBwbnJEYXRhLlBhc3NlbmdlcnMuUGFzc2VuZ2VyLmxlbmd0aDtcbiAgICAgICAgICAgIHRoaXMudG90YWxQYXggPSB0b3RhbFBheDtcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwicG5yUmVjbG9jXCIscG5yUmVjbG9jKTsgICAgICAgICAgICBcbiAgICAgICAgICAgIHZhciB0b2RheSA9IG5ldyBEYXRlKCk7XG4gICAgICAgICAgICBsZXQgeWVhciA9IHRvZGF5LmdldEZ1bGxZZWFyKCkudG9TdHJpbmcoKTtcbiAgICAgICAgICAgIGxldCBtb250aCA9IHRvZGF5LmdldE1vbnRoKCkgKyAxO1xuICAgICAgICAgICAgbGV0IGRheSA9IHRvZGF5LmdldERhdGUoKTtcbiAgICAgICAgICAgIGxldCBkYXkyID0gKGRheSA8IDEwKSA/IFwiMFwiICsgZGF5LnRvU3RyaW5nKCkgOiBkYXkudG9TdHJpbmcoKTtcbiAgICAgICAgICAgIGxldCBtb250aDIgPSAobW9udGggPCAxMCkgPyBcIjBcIiArIG1vbnRoLnRvU3RyaW5nKCkgOiBtb250aC50b1N0cmluZygpO1xuICAgICAgICAgICAgbGV0IGFkZmxleFJlZiA9IHBuclJlY2xvYyArIHllYXJbMl0gKyB5ZWFyWzNdICsgbW9udGgyICsgZGF5MjtcbiAgICAgICAgICAgIGxldCBta3VwLCB0a3RGZWUsIGZlZSA9IFwiXCI7XG4gICAgICAgICAgICBsZXQgbWt1cFRvdGFsID0gMDtcbiAgICAgICAgICAgIGxldCBmZWVUb3RhbCA9IDA7XG4gICAgICAgICAgICBsZXQgcGF4TmFtZSA9IHBuckRhdGEuUGFzc2VuZ2Vycy5QYXNzZW5nZXJbMF0uR2l2ZW5OYW1lICsgXCIgXCIgKyBwbnJEYXRhLlBhc3NlbmdlcnMuUGFzc2VuZ2VyWzBdLlN1cm5hbWU7XG4gICAgICAgICAgICBpZiAocG5yRGF0YS5QcmljZVF1b3Rlcz8uUHJpY2VRdW90ZSkge1xuICAgICAgICAgICAgICAgIGxldCBhcnJheUZhcmVzID0gcG5yRGF0YS5QcmljZVF1b3Rlcy5QcmljZVF1b3RlO1xuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwiYXJyYXlGYXJlc1wiLGFycmF5RmFyZXMpOyAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBpZiAoYXJyYXlGYXJlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgYXJyYXlGYXJlcy5mb3JFYWNoKGVsZW1lbnQgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coXCJlbGVtZW50XCIsZWxlbWVudC5UYXhlcy5Ub3RhbFRheFsnQ3VycmVuY3knXSk7ICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWxlbWVudC5UYXhlcy5Ub3RhbFRheFsnQ3VycmVuY3knXSA9PSBcIkdCUFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IG9uZVBRID0gbmV3IHBxRmFyZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBvbmVQUS5jdXJyID0gZWxlbWVudC5CYXNlRmFyZS5BbW91bnQuQ3VycmVuY3k7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGl0ZW0gPSBlbGVtZW50WydJZCddLnRvU3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb25lUFEuaXRlbSA9IGl0ZW1baXRlbS5sZW5ndGggLSAxXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbmVQUS50b3RhbCA9IGVsZW1lbnQuVG90YWwuQW1vdW50WydBbW91bnQnXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbmVQUS50YXhlcyA9IGVsZW1lbnQuVGF4ZXMuVG90YWxUYXhbJ0Ftb3VudCddO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHByaWNlU3RyaW5nID0gZWxlbWVudC50b3RhbHMuc3VidG90YWw7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gb25lUFEuc3VidG90YWwgPSBwYXJzZUZsb2F0KHByaWNlU3RyaW5nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcIm9uZVBRXCIsb25lUFEpOyAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBxRmFyZUxpc3QucHVzaChvbmVQUSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHBuckRhdGEuRm9ybU9mUGF5bWVudHM/LkZvcm1PZlBheW1lbnQpIHtcbiAgICAgICAgICAgICAgICBsZXQgYXJyYXlGYXJlcyA9IHBuckRhdGEuRm9ybU9mUGF5bWVudHMuRm9ybU9mUGF5bWVudDtcbiAgICAgICAgICAgICAgICBpZiAoYXJyYXlGYXJlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgYXJyYXlGYXJlcy5mb3JFYWNoKGVsZW1lbnQgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IG9uZUNDID0gbmV3IGNjRGF0YTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uZUNDLmNvZGUgPSBlbGVtZW50LkNyZWRpdENhcmRbJ0NyZWRpdENhcmRDb2RlJ107XG4gICAgICAgICAgICAgICAgICAgICAgICBvbmVDQy5jYXJkTWFza2VkID0gb25lQ0MuY29kZSArIGVsZW1lbnQuQ3JlZGl0Q2FyZFsnQ3JlZGl0Q2FyZE51bWJlciddO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9uZUNDLmNhcmRNYXNrZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgbGFzdDRkaWdpdHMgPSBcIlwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSBvbmVDQy5jYXJkTWFza2VkLmxlbmd0aCAtIDQ7IGkgPCBvbmVDQy5jYXJkTWFza2VkLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3Q0ZGlnaXRzID0gbGFzdDRkaWdpdHMgKyBvbmVDQy5jYXJkTWFza2VkW2ldLnRvU3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uZUNDLmxhc3Q0ID0gbGFzdDRkaWdpdHM7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBvbmVDQy55ZWFyID0gZWxlbWVudC5DcmVkaXRDYXJkWydFeHBpcmF0aW9uWWVhciddWzJdICsgZWxlbWVudC5DcmVkaXRDYXJkWydFeHBpcmF0aW9uWWVhciddWzNdO1xuICAgICAgICAgICAgICAgICAgICAgICAgb25lQ0MubW9udGggPSBlbGVtZW50LkNyZWRpdENhcmRbJ0V4cGlyYXRpb25Nb250aCddO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coXCJvbmVDQyBcIiwgb25lQ0MpOyAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jcmVkaXRDYXJkTGlzdC5wdXNoKG9uZUNDKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAocG5yRGF0YS5SZW1hcmtzPy5SZW1hcmspIHtcbiAgICAgICAgICAgICAgICBsZXQgaW52b2ljZVJta3MgPSBwbnJEYXRhLlJlbWFya3MuUmVtYXJrO1xuICAgICAgICAgICAgICAgIGlmIChpbnZvaWNlUm1rcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgaW52b2ljZVJta3MuZm9yRWFjaChlbGVtZW50ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlbGVtZW50WydUeXBlJ10gPT0gXCJJbnZvaWNlXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgcGFydE1rdXAgPSBlbGVtZW50WydUZXh0J10uc3BsaXQoXCJNS1VQL1wiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFydE1rdXBbMV0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHNsYXNoID0gcGFydE1rdXBbMV0uc3BsaXQoXCIvXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBta3VwID0gc2xhc2hbMV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1rdXBUb3RhbCA9IG1rdXBUb3RhbCArIHBhcnNlRmxvYXQobWt1cCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBwYXJ0VGt0ID0gZWxlbWVudFsnVGV4dCddLnNwbGl0KFwiVEtURkVFL1wiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFydFRrdFsxXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0a3RGZWUgPSBwYXJ0VGt0WzFdXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFydFRrdCA9IGVsZW1lbnRbJ1RleHQnXS5zcGxpdChcIkZFRS9cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJ0VGt0WzFdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmZWUgPSBwYXJ0VGt0WzFdXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGNtUm1rID0gZWxlbWVudFsnVGV4dCddLnNwbGl0KFwiQ00tXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjbVJta1sxXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgcm1rID0gbmV3IHJlbWFyaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm1rLlR5cGUgPSBcIkl0aW5lcmFyeVwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBybWsuSWQgPSBlbGVtZW50LlNvdXJjZVsnSWQnXS50b1N0cmluZygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBybWsuVGV4dCA9IGVsZW1lbnRbJ1RleHQnXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm1rLkNvZGUgPSBcIkNNXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVSbWtzLnB1c2gocm1rKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHBheW1lbnQgPSBlbGVtZW50WydUZXh0J10uc3BsaXQoXCJQQVlNRU5UL1wiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGF5bWVudFsxXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgcm1rID0gbmV3IHJlbWFyaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm1rLlR5cGUgPSBcIkl0aW5lcmFyeVwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBybWsuSWQgPSBlbGVtZW50LlNvdXJjZVsnSWQnXS50b1N0cmluZygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBybWsuVGV4dCA9IGVsZW1lbnRbJ1RleHQnXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm1rLkNvZGUgPSBcIlBBWVwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlUm1rcy5wdXNoKHJtayk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcInRoaXMudXBkYXRlUm1rc1wiLHRoaXMudXBkYXRlUm1rcyk7ICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAodGt0RmVlKSB7XG4gICAgICAgICAgICAgICAgZmVlVG90YWwgPSB0b3RhbFBheCAqIHBhcnNlRmxvYXQodGt0RmVlKTtcbiAgICAgICAgICAgIH0gaWYgKGZlZSkge1xuICAgICAgICAgICAgICAgIGZlZVRvdGFsID0gcGFyc2VGbG9hdChmZWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IHRvdGFsQW10ID0gbWt1cFRvdGFsICsgZmVlVG90YWw7XG4gICAgICAgICAgICB0aGlzLmdldE1vZGVsKCkuc2V0KCdtYXJrVXBGZWUnLCBta3VwVG90YWwudG9GaXhlZCgyKSk7XG4gICAgICAgICAgICB0aGlzLmdldE1vZGVsKCkuc2V0KCd0a3RGZWUnLCBmZWVUb3RhbC50b0ZpeGVkKDIpKTtcbiAgICAgICAgICAgIHRoaXMuZ2V0TW9kZWwoKS5zZXQoJ3NlbGVjdFBxJywgdGhpcy5wcUZhcmVMaXN0KTtcbiAgICAgICAgICAgIHRoaXMuZ2V0TW9kZWwoKS5zZXQoJ2NyZWRpdENhcmRzJywgdGhpcy5jcmVkaXRDYXJkTGlzdCk7XG4gICAgICAgICAgICB0aGlzLmdldE1vZGVsKCkuc2V0KCduYW1lJywgcGF4TmFtZSk7XG4gICAgICAgICAgICB0aGlzLmdldE1vZGVsKCkuc2V0KCdyZWZJZCcsIGFkZmxleFJlZik7XG4gICAgICAgICAgICB0aGlzLmdldE1vZGVsKCkuc2V0KCd0b3RhbCcsIHRvdGFsQW10LnRvRml4ZWQoMikgKyBcIiBHQlBcIik7XG4gICAgICAgICAgICB0aGlzLmdldE1vZGVsKCkuc2V0KCd2ZW5kb3JzJywgdGhpcy52ZW5kb3JzKTtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyKCk7XG4gICAgICAgICAgICAvLyB0aGlzLnVwZGF0ZVRvdGFsKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGxvYWRBbW91bnQoc2VsZWN0b3I6IEpRdWVyeUV2ZW50T2JqZWN0KTogdm9pZCB7XG4gICAgICAgIGxldCBpdGVtID0gdGhpcy4kKCcjc2VsZWN0UHEnKS5jaGlsZHJlbihcIm9wdGlvbjpzZWxlY3RlZFwiKS52YWwoKTtcbiAgICAgICAgaWYgKHNlbGVjdG9yLnRhcmdldCkge1xuICAgICAgICAgICAgdGhpcy5wcUZhcmVMaXN0LmZvckVhY2goZWxlbWVudCA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGVsZW1lbnRbJ2l0ZW0nXSA9PSBpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgICg8SFRNTElucHV0RWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImFtdFwiKSkudmFsdWUgPSBlbGVtZW50Wyd0b3RhbCddLnRvU3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlVG90YWwoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICQoJyNzZWxlY3RQcScpLnZhbChpdGVtKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgbG9hZEV4cGlyYXRpb24oc2VsZWN0b3I6IEpRdWVyeUV2ZW50T2JqZWN0KTogdm9pZCB7XG4gICAgICAgIGxldCBjYXJkID0gdGhpcy4kKCcjY3JlZGl0Q2FyZHMnKS5jaGlsZHJlbihcIm9wdGlvbjpzZWxlY3RlZFwiKS52YWwoKTtcbiAgICAgICAgaWYgKHNlbGVjdG9yLnRhcmdldCkge1xuICAgICAgICAgICAgdGhpcy5jcmVkaXRDYXJkTGlzdC5mb3JFYWNoKGVsZW1lbnQgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChlbGVtZW50WydjYXJkTWFza2VkJ10gPT0gY2FyZCkge1xuICAgICAgICAgICAgICAgICAgICAoPEhUTUxJbnB1dEVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjYXJkSW5Vc2VcIikpLnZhbHVlID0gY2FyZDtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGV4cCA9IGVsZW1lbnRbJ21vbnRoJ10gKyBcIi9cIiArIGVsZW1lbnRbJ3llYXInXTtcbiAgICAgICAgICAgICAgICAgICAgKDxIVE1MSW5wdXRFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZXhwaXJhdGlvblwiKSkudmFsdWUgPSBleHA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAkKCcjY3JlZGl0Q2FyZHMnKS52YWwoY2FyZCk7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHdyaXRlQ0MgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNhcmRJblVzZVwiKTtcbiAgICAgICAgaWYgKGNhcmQgPT0gXCJhZGRDQ1wiKSB7XG4gICAgICAgICAgICAoPEhUTUxJbnB1dEVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjYXJkSW5Vc2VcIikpLnZhbHVlID0gXCJcIjtcbiAgICAgICAgICAgICg8SFRNTElucHV0RWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImV4cGlyYXRpb25cIikpLnZhbHVlID0gXCJcIjtcbiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidmVuZG9yXCIpLnJlbW92ZUF0dHJpYnV0ZShcImRpc2FibGVkXCIpO1xuICAgICAgICAgICAgd3JpdGVDQy5yZW1vdmVBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHdyaXRlQ0Muc2V0QXR0cmlidXRlKFwiZGlzYWJsZWRcIiwgXCJcIik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIHVwZGF0ZVRvdGFsKHNlbGVjdG9yPzogSlF1ZXJ5RXZlbnRPYmplY3QpOiB2b2lkIHtcbiAgICAgICAgbGV0IG1hcmtVcEZlZSA9IDA7XG4gICAgICAgIGxldCBhbXQgPSAwO1xuICAgICAgICBsZXQgYWRkaXRpb25hbCA9IDA7XG4gICAgICAgIGxldCB0a3RGZWUgPSAwO1xuICAgICAgICBpZiAoKDxIVE1MSW5wdXRFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibWFya1VwRmVlXCIpKS52YWx1ZSkge1xuICAgICAgICAgICAgbWFya1VwRmVlID0gcGFyc2VGbG9hdCgoPEhUTUxJbnB1dEVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJtYXJrVXBGZWVcIikpLnZhbHVlKTtcbiAgICAgICAgICAgICg8SFRNTElucHV0RWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm1hcmtVcEZlZVwiKSkudmFsdWUgPSBtYXJrVXBGZWUudG9GaXhlZCgyKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoKDxIVE1MSW5wdXRFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYW10XCIpKS52YWx1ZSkge1xuICAgICAgICAgICAgYW10ID0gcGFyc2VGbG9hdCgoPEhUTUxJbnB1dEVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJhbXRcIikpLnZhbHVlKTtcbiAgICAgICAgICAgICg8SFRNTElucHV0RWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImFtdFwiKSkudmFsdWUgPSBhbXQudG9GaXhlZCgyKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoKDxIVE1MSW5wdXRFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYWRkaXRpb25hbFwiKSkudmFsdWUpIHtcbiAgICAgICAgICAgIGFkZGl0aW9uYWwgPSBwYXJzZUZsb2F0KCg8SFRNTElucHV0RWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImFkZGl0aW9uYWxcIikpLnZhbHVlKTtcbiAgICAgICAgICAgICg8SFRNTElucHV0RWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImFkZGl0aW9uYWxcIikpLnZhbHVlID0gYWRkaXRpb25hbC50b0ZpeGVkKDIpO1xuICAgICAgICB9XG4gICAgICAgIGlmICgoPEhUTUxJbnB1dEVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ0a3RGZWVcIikpLnZhbHVlKSB7XG4gICAgICAgICAgICB0a3RGZWUgPSBwYXJzZUZsb2F0KCg8SFRNTElucHV0RWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInRrdEZlZVwiKSkudmFsdWUpO1xuICAgICAgICAgICAgKDxIVE1MSW5wdXRFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidGt0RmVlXCIpKS52YWx1ZSA9IHRrdEZlZS50b0ZpeGVkKDIpO1xuICAgICAgICB9XG4gICAgICAgIGxldCB0b3RhbCA9IG1hcmtVcEZlZSArIGFtdCArIGFkZGl0aW9uYWwgKyB0a3RGZWU7XG4gICAgICAgICg8SFRNTElucHV0RWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInRvdGFsXCIpKS52YWx1ZSA9IHRvdGFsLnRvRml4ZWQoMikgKyBcIiBHQlBcIjtcbiAgICB9XG5cbiAgICBhc3luYyBzZWxmTmV4dEFjdGlvbigpIHtcbiAgICAgICAgaWYgKHRoaXMuSW5wdXRWYWxpZGF0b3IoKSkge1xuICAgICAgICAgICAgdGhpcy5leGVjdXRlKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGV4ZWN1dGUoKSB7XG4gICAgICAgIGxldCBtYXJrVXBGZWUgPSAoPEhUTUxJbnB1dEVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcmtVcEZlZScpKS52YWx1ZTtcbiAgICAgICAgbGV0IGNjTmFtZSA9ICg8SFRNTElucHV0RWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmFtZScpKS52YWx1ZTtcbiAgICAgICAgbGV0IGZlZSA9ICg8SFRNTElucHV0RWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGt0RmVlJykpLnZhbHVlO1xuICAgICAgICBsZXQgcHFBbXQgPSAoPEhUTUxJbnB1dEVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FtdCcpKS52YWx1ZTtcbiAgICAgICAgbGV0IGFkZGl0aW9uYWwgPSAoPEhUTUxJbnB1dEVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FkZGl0aW9uYWwnKSkudmFsdWU7XG4gICAgICAgIGxldCB0b3RhbCA9ICg8SFRNTElucHV0RWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG90YWwnKSkudmFsdWU7XG4gICAgICAgIGxldCBmdWxsQ2FyZCA9IHRoaXMuJCgnI2NyZWRpdENhcmRzJykuY2hpbGRyZW4oXCJvcHRpb246c2VsZWN0ZWRcIikudmFsKCk7XG4gICAgICAgIGxldCBvcHRpb24gPSB0aGlzLiQoJyN0ZXN0JykuY2hpbGRyZW4oXCJvcHRpb246c2VsZWN0ZWRcIikudmFsKCk7XG4gICAgICAgIGxldCBsYXN0NCA9IFwiXCI7XG4gICAgICAgIGxldCBjb2RlO1xuICAgICAgICBpZiAoZnVsbENhcmQgPT0gXCJhZGRDQ1wiKSB7XG4gICAgICAgICAgICBjb2RlID0gdGhpcy4kKCcjdmVuZG9yJykuY2hpbGRyZW4oXCJvcHRpb246c2VsZWN0ZWRcIikudmFsKCk7XG4gICAgICAgICAgICBmdWxsQ2FyZCA9ICg8SFRNTElucHV0RWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNhcmRJblVzZVwiKSkudmFsdWU7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gZnVsbENhcmQubGVuZ3RoIC0gNDsgaSA8IGZ1bGxDYXJkLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgbGFzdDQgPSBsYXN0NCArIGZ1bGxDYXJkW2ldLnRvU3RyaW5nKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcImFkZENDIHNlbGVjdGVkXCIsIGZ1bGxDYXJkKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGxldCBjYXJkU2VsZWN0ZWQgPSB0aGlzLmNyZWRpdENhcmRMaXN0LmZpbHRlcih4ID0+IHhbJ2NhcmRNYXNrZWQnXSA9PSBmdWxsQ2FyZCk7XG4gICAgICAgICAgICBsYXN0NCA9IGNhcmRTZWxlY3RlZFswXVsnbGFzdDQnXTtcbiAgICAgICAgICAgIGNvZGUgPSBjYXJkU2VsZWN0ZWRbMF1bJ2NvZGUnXTtcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwiY2FyZE1hc2tlZCBzZWxlY3RlZFwiLCBjYXJkU2VsZWN0ZWQpO1xuICAgICAgICB9XG4gICAgICAgIGxldCByZWZJZCA9ICg8SFRNTElucHV0RWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVmSWQnKSkudmFsdWU7XG4gICAgICAgIGxldCBleHAgPSAoPEhUTUxJbnB1dEVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V4cGlyYXRpb24nKSkudmFsdWU7XG4gICAgICAgIGxldCBleHBNb250aCA9IGV4cC5zcGxpdChcIi9cIilbMF07XG4gICAgICAgIGxldCBleHBZZWFyID0gZXhwLnNwbGl0KFwiL1wiKVsxXTtcbiAgICAgICAgLy8gbGV0IHh4eHh4eHh4eHggID0gKDxIVE1MSW5wdXRFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd4eHh4eHh4eHh4eHgnKSkudmFsdWU7XG4gICAgICAgIC8vIGxldCB4eHh4eHh4eHh4ICA9ICg8SFRNTElucHV0RWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgneHh4eHh4eHh4eHh4JykpLnZhbHVlO1xuXG4gICAgICAgIGxldCBwYWNrOiB7fSA9IHtcbiAgICAgICAgICAgIFwibWFya1VwRmVlXCI6IG1hcmtVcEZlZSxcbiAgICAgICAgICAgIFwiZmVlXCI6IGZlZSxcbiAgICAgICAgICAgIFwibmFtZVwiOiBjY05hbWUsXG4gICAgICAgICAgICBcInBxQW10XCI6IHBxQW10LFxuICAgICAgICAgICAgXCJhZGRpdGlvbmFsXCI6IGFkZGl0aW9uYWwsXG4gICAgICAgICAgICBcInRvdGFsXCI6IHRvdGFsLFxuICAgICAgICAgICAgXCJmdWxsQ2FyZFwiOiBmdWxsQ2FyZCxcbiAgICAgICAgICAgIFwiZXhwTW9udGhcIjogZXhwTW9udGgsXG4gICAgICAgICAgICBcImV4cFllYXJcIjogZXhwWWVhcixcbiAgICAgICAgICAgIFwiY2FyZDRcIjogbGFzdDQsXG4gICAgICAgICAgICBcIm9wdGlvblwiOiBvcHRpb24sXG4gICAgICAgICAgICBcImNjQ29kZVwiOiBjb2RlLFxuICAgICAgICAgICAgXCJyZWZJZFwiOiByZWZJZCxcbiAgICAgICAgICAgIFwiVXBkYXRlUm1rXCI6IHRoaXMudXBkYXRlUm1rc1xuICAgICAgICB9XG4gICAgICAgIGNvbnNvbGUubG9nKFwicGFja1wiLCBwYWNrKTtcbiAgICAgICAgY29uc3QgcmVzdE1vZGFsT3B0aW9ucyA9IHtcbiAgICAgICAgICAgIHRpdGxlOiAnQ29uZmlybWF0aW9uJyxcbiAgICAgICAgICAgIGFjdGlvbnM6IFtcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2FwcC5jb21tb24udmlld3MuQnV0dG9uJyxcbiAgICAgICAgICAgICAgICAgICAgY2FwdGlvbjogJ0NhbmNlbCcsXG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbk5hbWU6ICdjYW5jZWwnLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnc2Vjb25kYXJ5J1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICdhcHAuY29tbW9uLnZpZXdzLkJ1dHRvbicsXG4gICAgICAgICAgICAgICAgICAgIGNhcHRpb246ICdCYWNrJyxcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uTmFtZTogJ2JhY2snLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnc2Vjb25kYXJ5J1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICdhcHAuY29tbW9uLnZpZXdzLkJ1dHRvbicsXG4gICAgICAgICAgICAgICAgICAgIGNhcHRpb246IFwiQWRkIFJlbWFya3NcIixcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uTmFtZTogJ25leHQnLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnc3VjY2VzcydcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICBdXG4gICAgICAgIH07XG5cbiAgICAgICAgZ2V0U2VydmljZShMYXllclNlcnZpY2UpLnNob3dJbk1vZGFsKFxuICAgICAgICAgICAgbmV3IENoZWNrVG90YWwoeyBtb2RlbDogbmV3IFJlc3RNb2RlbCgpIH0sIHBhY2spLFxuICAgICAgICAgICAgcmVzdE1vZGFsT3B0aW9ucyxcbiAgICAgICAgICAgIHsgZGlzcGxheTogJ2FyZWFWaWV3JyB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIElucHV0VmFsaWRhdG9yKCk6IGJvb2xlYW4ge1xuICAgICAgICBsZXQgYWxsT2sgPSB0cnVlO1xuICAgICAgICBsZXQgdG90YWwgPSAoPEhUTUxJbnB1dEVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ0b3RhbFwiKSkudmFsdWU7XG4gICAgICAgIGlmIChwYXJzZUZsb2F0KHRvdGFsLnNwbGl0KFwiR0JQXCIpWzBdKSA+IDApIHtcbiAgICAgICAgICAgIHRoaXMuZmllbGRPayhcInRvdGFsXCIpO1xuICAgICAgICAgICAgbGV0IHJlcXVpcmVkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnW3JlcXVpcmVkXScpXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJlcXVpcmVkLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgbGV0IGlkID0gcmVxdWlyZWRbaV0uaWQ7XG4gICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coXCJJbnB1dFZhbGlkYXRvcjpcIiArIGlkKTtcbiAgICAgICAgICAgICAgICBsZXQgdmFsdWVSZWFkID0gKDxIVE1MU2VsZWN0RWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCkpLnZhbHVlO1xuICAgICAgICAgICAgICAgIGlmIChpZCA9PSBcImNyZWRpdENhcmRzXCIgJiYgdmFsdWVSZWFkID09IFwiY2NOb1NlbGVjdGVkXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lcnJvck9uRmllbGQoaWQsIFwiRmllbGQgY2Fubm90IGJlIGVtcHR5IG9yIGJsYW5rXCIpO1xuICAgICAgICAgICAgICAgICAgICBhbGxPayA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlkID09IFwiY3JlZGl0Q2FyZHNcIiAmJiB2YWx1ZVJlYWQgPT0gXCJhZGRDQ1wiKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXR1c1tcImNyZWRpdENhcmRzXCJdID09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmllbGRPayhcImNyZWRpdENhcmRzXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmICgoPEhUTUxTZWxlY3RFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidmVuZG9yXCIpKS52YWx1ZSA9PSBcIm5vVmVuZG9yXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhdHVzWyd2ZW5kb3InXSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVycm9yT25GaWVsZChcInZlbmRvclwiLCBcIlNlbGVjdCBvbmVcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBhbGxPayA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZpZWxkT2soXCJ2ZW5kb3JcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgbGV0IHR5cGVkQ2FyZCA9ICg8SFRNTElucHV0RWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNhcmRJblVzZVwiKSkudmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlZENhcmQubGVuZ3RoID09IDE2ICYmIHRoaXMuc3RhdHVzWydjYXJkSW5Vc2UnXSA9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZpZWxkT2soJ2NhcmRJblVzZScpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVkQ2FyZC5sZW5ndGggPiAxNikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lcnJvck9uRmllbGQoXCJjYXJkSW5Vc2VcIiwgXCJNYXhpbXVtIDE2IG51bWJlcnNcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBhbGxPayA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZWRDYXJkLmxlbmd0aCA8PSAxNSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0dXNbJ2NhcmRJblVzZSddID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZXJyb3JPbkZpZWxkKFwiY2FyZEluVXNlXCIsIFwiTWluaW11bSAxNiBudW1iZXJzXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYWxsT2sgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpZCA9PSBcIm5hbWVcIikge1xuICAgICAgICAgICAgICAgICAgICBsZXQgbmFtZSA9ICg8SFRNTElucHV0RWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm5hbWVcIikpLnZhbHVlO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIW5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwiZW50cm8hXCIpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVycm9yT25GaWVsZChcIm5hbWVcIiwgXCJOYW1lIGlzIG1hbmRhdG9yeVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFsbE9rID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChuYW1lICYmIHRoaXMuc3RhdHVzW1wibmFtZVwiXSA9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZpZWxkT2soXCJjcmVkaXRDYXJkc1wiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaWQgPT0gXCJuYW1lXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IG5hbWUgPSAoPEhUTUxJbnB1dEVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJuYW1lXCIpKS52YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFuYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVycm9yT25GaWVsZChcIm5hbWVcIiwgXCJOYW1lIGlzIG1hbmRhdG9yeVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFsbE9rID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChuYW1lICYmIHRoaXMuc3RhdHVzW1wibmFtZVwiXSA9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZpZWxkT2soXCJjcmVkaXRDYXJkc1wiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaWQgPT0gXCJleHBpcmF0aW9uXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGV4cGlyYXRpb24gPSAoPEhUTUxJbnB1dEVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJleHBpcmF0aW9uXCIpKS52YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFleHBpcmF0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVycm9yT25GaWVsZChcImV4cGlyYXRpb25cIiwgXCJFeHBpcmF0aW9uIGlzIG1hbmRhdG9yeVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFsbE9rID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlmICh0aGlzLnN0YXR1c1tcImV4cGlyYXRpb25cIl0gPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgIHRoaXMuZmllbGRPayhcImV4cGlyYXRpb25cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyB9ICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgZGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgeWVhcjQgPSBkYXRlLmdldEZ1bGxZZWFyKCkudG9TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCB0aGlzTW9udGggPSBkYXRlLmdldE1vbnRoKCkgKyAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHllYXIyID0gcGFyc2VGbG9hdCh5ZWFyNFsyXSArIHllYXI0WzNdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBleHAgPSAoPEhUTUxJbnB1dEVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJleHBpcmF0aW9uXCIpKS52YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBleHBNb250aCA9IHBhcnNlRmxvYXQoZXhwLnNwbGl0KFwiL1wiKVswXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgZXhwWWVhciA9IHBhcnNlRmxvYXQoZXhwLnNwbGl0KFwiL1wiKVsxXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcImV4cE1vbnRoXCIsIGV4cE1vbnRoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwidGhpc01vbnRoXCIsIHRoaXNNb250aCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc05hTihleHBNb250aCkgfHwgaXNOYU4oZXhwWWVhcikgfHwgZXhwTW9udGggPiAxMiB8fCBleHBNb250aCA8IDEgfHwgZXhwWWVhciA8IHllYXIyIHx8IChleHBZZWFyID09IHllYXIyICYmIGV4cE1vbnRoIDwgdGhpc01vbnRoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZXJyb3JPbkZpZWxkKFwiZXhwaXJhdGlvblwiLCBcIk1NL1lZIGxpa2U6IDA1LzI3XCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxsT2sgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5maWVsZE9rKFwiZXhwaXJhdGlvblwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuZXJyb3JPbkZpZWxkKFwidG90YWxcIiwgXCJNdXN0IGJlIGdyZWF0ZXIgdGhhbiAwXCIpXG4gICAgICAgICAgICBhbGxPayA9IGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gaWYgKHRoaXMuc3RhdHVzW1wiYWRkQ0NcIl0gPT0gdHJ1ZSkge1xuICAgICAgICAvLyAgICAgKDxIVE1MRGl2RWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNyZWRpdENhcmRzRGl2XCIpKS5jbGFzc0xpc3QucmVtb3ZlKFwiaGFzLWVycm9yXCIpOyBcbiAgICAgICAgLy8gICAgICg8SFRNTERpdkVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjcmVkaXRDYXJkc0Vycm9yXCIpKS5pbm5lclRleHQgPSBcIlwiO1xuICAgICAgICAvLyAgICAgdGhpcy5zdGF0dXNbXCJhZGRDQ1wiXSA9IGZhbHNlO1xuICAgICAgICAvLyAgICAgaWQgPSBcImNhcmRJblVzZVwiO1xuICAgICAgICAvLyAgICAgaWYgKCEoPEhUTUxTZWxlY3RFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKSkudmFsdWUpIHtcbiAgICAgICAgLy8gICAgICAgICB0aGlzLmVycm9yT25GaWVsZChpZCwgXCJUeXBlIGNyZWRpdCBjYXJkIG51bWJlclwiKTtcbiAgICAgICAgLy8gICAgICAgICBhbGxPayA9IGZhbHNlO1xuICAgICAgICAvLyAgICAgICAgIGJyZWFrO1xuICAgICAgICAvLyAgICAgfVxuICAgICAgICAvLyB9IGVsc2Uge1xuICAgICAgICAvLyAgICAgdGhpcy5lcnJvck9uRmllbGQoaWQsIFwiRmllbGQgY2Fubm90IGJlIGVtcHR5IG9yIGJsYW5rXCIpO1xuICAgICAgICAvLyAgICAgYWxsT2sgPSBmYWxzZTtcbiAgICAgICAgLy8gICAgIGJyZWFrO1xuICAgICAgICAvLyB9XG5cbiAgICAgICAgLy8gZWxzZSB7XG4gICAgICAgIC8vICAgICB0aGlzLmZpZWxkT2soaWQpO1xuICAgICAgICAvLyB9XG4gICAgICAgIHJldHVybiBhbGxPaztcbiAgICB9XG5cbiAgICBwcml2YXRlIGVycm9yT25GaWVsZChpZDogc3RyaW5nLCBtZXNzYWdlOiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgKDxIVE1MRGl2RWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCArIFwiRXJyb3JcIikpLmlubmVyVGV4dCA9IG1lc3NhZ2U7XG4gICAgICAgICg8SFRNTERpdkVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQgKyBcIkRpdlwiKSkuY2xhc3NMaXN0LmFkZChcImhhcy1lcnJvclwiKTtcbiAgICAgICAgKDxIVE1MSW5wdXRFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKSkuZm9jdXMoKTtcbiAgICAgICAgdGhpcy5zdGF0dXNbaWRdID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGZpZWxkT2soaWQ6IHN0cmluZyk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5zdGF0dXNbaWRdID09IHRydWUpIHtcbiAgICAgICAgICAgICg8SFRNTERpdkVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQgKyBcIkRpdlwiKSkuY2xhc3NMaXN0LnJlbW92ZShcImhhcy1lcnJvclwiKTtcbiAgICAgICAgICAgICg8SFRNTERpdkVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQgKyBcIkVycm9yXCIpKS5pbm5lclRleHQgPSBcIlwiO1xuICAgICAgICAgICAgdGhpcy5zdGF0dXNbaWRdID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG59XG4iXSwic291cmNlUm9vdCI6IiJ9 