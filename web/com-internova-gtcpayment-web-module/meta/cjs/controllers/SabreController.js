"use strict";var __extends=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function __(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.SabreController=void 0;var AbstractService_1=require("sabre-ngv-app/app/services/impl/AbstractService"),Context_1=require("../Context"),SabreService_1=require("../services/SabreService"),ICommandMessageService_1=require("sabre-ngv-commsg/services/ICommandMessageService"),Utilitario_1=require("../common/Utilitario"),SabreController=function(e){function SabreController(){return null!==e&&e.apply(this,arguments)||this}return __extends(SabreController,e),SabreController.prototype.buildRequestGetReservation=function(e){var t=this;return new Promise(function(r,n){t.buildGetReservationRQ(e,"GetReservationRQ").then(function(e){(0,Context_1.getService)(SabreService_1.SabreService).callSoapServiceAsync(e,"GetReservationRQ","SESSION",1e4).then(function(e){console.log("resolver GetReservationRQ",e),r(!0)}).catch(function(e){n(e)})}).catch(function(e){})})},SabreController.prototype.buildRequestAddRemark=function(e){var t=this;return new Promise(function(r,n){console.log("listRemarks on buildRequestAddRemark",e),t.buildAddRemarkRQ(e,"AddRemarkLLSRQ").then(function(e){(0,Context_1.getService)(SabreService_1.SabreService).callSoapServiceAsync(e,"AddRemarkLLSRQ","SESSION",1e4).then(function(e){console.log("resolver AddRemarkLLSRQ",e),r(!0)}).catch(function(e){n(e)})}).catch(function(e){})})},SabreController.prototype.RemarkUpdate=function(e){var t=this;return new Promise(function(r,n){t.buildRemarkUpdateRQ(e,"UpdateReservationRQrmk").then(function(e){(0,Context_1.getService)(SabreService_1.SabreService).callSoapServiceAsync(e,"UpdateReservationRQ","SESSION",1e4).then(function(e){console.log("resolver UpdateReservationRQ",e),r(!0)}).catch(function(e){n(e)})}).catch(function(e){})})},SabreController.prototype.SendCommandAsync=function(e){var t=this;return new Promise(function(r,n){t.buildRequestSabreCommand(e,"SabreCommandLLSRQ").then(function(e){(0,Context_1.getService)(SabreService_1.SabreService).callSoapServiceAsync(e,"SabreCommandLLSRQ","SESSION",1e4).then(function(e){r(!0)}).catch(function(e){n(e)})}).catch(function(e){})})},SabreController.prototype.SendCommandAsyncRs=function(e){var t=this;return new Promise(function(r,n){t.buildRequestSabreCommand(e,"SabreCommandLLSRQ").then(function(e){console.log("resp:",e),(0,Context_1.getService)(SabreService_1.SabreService).callSoapServiceAsync(e,"SabreCommandLLSRQ","SESSION",1e4).then(function(e){var t=(0,Context_1.getService)(Utilitario_1.Utilitario).StringToXml(e).getElementsByTagName("Response");r(t[0].childNodes[0].nodeValue)}).catch(function(e){n(e)})}).catch(function(e){})})},SabreController.prototype.SendCommandSync=function(e){var t=null,r=this.buildRequestSendCommand(e);if(null!=r&&null!=(t=(0,Context_1.getService)(SabreService_1.SabreService).callSoapServiceSync(r,"SabreCommandLLSRQ"))){var n=JSON.parse(t);return t="",null!=n.response&&n.response.success&&(t=n.response.payload.responseText),t}return t},SabreController.prototype.SendCommandMessage=function(e,t,r){return(0,Context_1.getService)(ICommandMessageService_1.ICommandMessageService).send({rq:e,showRq:t,showRs:r})},SabreController.prototype.checkNodeValues=function(e,t,r){var n="";if(r.localName==e&&r.hasAttributes)for(var o=r.attributes,a=0;a<o.length;a++)o[a].name==t&&(n=o[a].value);return n},SabreController.prototype.GetFinalValue=function(e,t,r,n){var o=new Array;o.push([t,r]),"*"==n&&o.push(["segtype",e.localName]);for(var a=e.childNodes,i=0;i<a.length;i++){var l=a[i];if(l.localName){var c=l.localName,s=l.textContent;o.push([c,s])}}return o},SabreController.prototype.GetElement=function(e,t,r){r&&(e=(0,Context_1.getService)(Utilitario_1.Utilitario).RemoveNameSpace(e));var n=(new DOMParser).parseFromString(e,"text/xml").childNodes[0];if(n.hasAttributes)for(var o=n.attributes,a=!1,i=0;i<o.length;i++){if("xmlns"==o[i].name.split(":")[0]&&!a){var l=o[i].value;a=!0}}return(0,Context_1.getService)(Utilitario_1.Utilitario).GetXPathResult(e,t,function resolverNS(){return l},0).iterateNext()},SabreController.prototype.AddRemarksAsync=function(e){var t=this;return new Promise(function(r,n){t.buildRequestAddRemark(e)})},SabreController.prototype.buildRequestReservation=function(e){return new Promise(function(t,r){(0,Context_1.getService)(Utilitario_1.Utilitario).GetPayLoad(e).then(function(e){t(e)}).catch(function(e){r(e)})})},SabreController.prototype.buildAddRemarkRQ=function(e,t){return new Promise(function(r,n){var o=null;console.log("listRemarks on buildAddRemarkRQ",e);var a=(0,Context_1.getService)(Utilitario_1.Utilitario);a.GetPayLoad(t).then(function(t){var n=a.StringToXml(t);console.log("StringToXml",n);var i=n.getElementsByTagName("RemarkInfo");if(null!=e&&e.length>0)for(var l=0,c=e;l<c.length;l++){var s=c[l];console.log("rmk",s);var u=i[0].appendChild(n.createElement("Remark"));u.setAttribute("Type",s.Type),s.Code&&u.setAttribute("Code",s.Code),s.SegNum&&u.setAttribute("SegmentNumber",s.SegNum),u.appendChild(n.createElement("Text")).textContent=s.Text}o=(o=a.DocumentToString(n)).replace(/xmlns=""/g,""),r(o)}).catch(function(e){n(e)})})},SabreController.prototype.buildRemarkUpdateRQ=function(e,t){return new Promise(function(r,n){var o=null,a=(0,Context_1.getService)(Utilitario_1.Utilitario);a.GetPayLoad(t).then(function(t){var n=a.StringToXml(t),i=n.getElementsByTagName("ReservationUpdateItem");if(null!=e&&e.length>0)for(var l=0,c=e;l<c.length;l++){var s=c[l],u=i[0].appendChild(n.createElement("RemarkUpdate"));u.setAttribute("id",s.Id),u.setAttribute("type","INVOICE"),u.setAttribute("op","U"),u.appendChild(n.createElement("RemarkText")).textContent=s.Text}o=(o=a.DocumentToString(n)).replace(/xmlns=""/g,""),r(o)}).catch(function(e){n(e)})})},SabreController.prototype.buildRequestSabreCommand=function(e,t){return new Promise(function(r,n){var o=null,a=(0,Context_1.getService)(Utilitario_1.Utilitario);a.GetPayLoad(t).then(function(t){if(null!=e){var i=a.StringToXml(t);i.getElementsByTagName("HostCommand")[0].textContent=e,console.log("resolver despues convertir",i.documentElement.innerHTML),o=a.DocumentToString(i),r(o)}else n()}).catch(function(e){n(e)})})},SabreController.prototype.buildRequestSendCommand=function(e){return'<SabreCommandLLSRQ xmlns="http://webservices.sabre.com/sabreXML/2003/07" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" TimeStamp="2014-03-04T14:00:00" Version="1.8.1"><Request Output="SCREEN" CDATA="false"><HostCommand>'+e+"</HostCommand></Request></SabreCommandLLSRQ>"},SabreController.prototype.buildGetReservationRQ=function(e,t){return new Promise(function(r,n){var o=null,a=(0,Context_1.getService)(Utilitario_1.Utilitario);a.GetPayLoad(t).then(function(t){var n=a.StringToXml(t);n.getElementsByTagName("Locator")[0].textContent=e,o=(o=a.DocumentToString(n)).replace(/xmlns=""/g,""),console.log("returnValue",o),r(o)}).catch(function(e){n(e)})})},SabreController.prototype.InputValidator=function(e){document.getElementById(e).value?(document.getElementById(e+"Div").classList.remove("has-error"),document.getElementById(e+"Error").innerText=""):(document.getElementById(e+"Div").classList.add("has-error"),document.getElementById(e+"Error").innerText="Field cannot be empty or blank")},SabreController.SERVICE_NAME="com-internova-gtcpayment-web-module-SabreController",SabreController}(AbstractService_1.AbstractService);exports.SabreController=SabreController;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9jb2RlL2NvbnRyb2xsZXJzL1NhYnJlQ29udHJvbGxlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiaW1CQUNBLElBQUEsa0JBQUEsUUFBQSxtREFDQSxVQUFBLFFBQUEsY0FDQSxlQUFBLFFBQUEsNEJBTUEseUJBQUEsUUFBQSxvREFDQSxhQUFBLFFBQUEsd0JBR0EsZ0JBQUEsU0FBQSxHQUFBLFNBQUEsaUVBcVpBLE9BclpxQyxVQUFBLGdCQUFBLEdBR2pDLGdCQUFBLFVBQUEsMkJBQUEsU0FBMkIsR0FBM0IsSUFBQSxFQUFBLEtBQ0ksT0FBTyxJQUFJLFFBQWlCLFNBQUMsRUFBUyxHQUNwQixFQUFLLHNCQUFzQixFQUFLLG9CQUV6QyxLQUFLLFNBQUEsSUFDRixFQUFBLFVBQUEsWUFBVyxlQUFBLGNBQWMscUJBQXFCLEVBQU0sbUJBQW9CLFVBQVcsS0FDOUUsS0FBSyxTQUFDLEdBQ0gsUUFBUSxJQUFJLDRCQUE2QixHQUN6QyxHQUFRLEtBRVgsTUFBTSxTQUFBLEdBQ0gsRUFBTyxPQUdsQixNQUFNLFNBQUEsU0FLbkIsZ0JBQUEsVUFBQSxzQkFBQSxTQUFzQixHQUF0QixJQUFBLEVBQUEsS0FDSSxPQUFPLElBQUksUUFBaUIsU0FBQyxFQUFTLEdBQ2xDLFFBQVEsSUFBSSx1Q0FBd0MsR0FFbkMsRUFBSyxpQkFBaUIsRUFBYSxrQkFFL0MsS0FBSyxTQUFBLElBQ0YsRUFBQSxVQUFBLFlBQVcsZUFBQSxjQUFjLHFCQUFxQixFQUFNLGlCQUFrQixVQUFXLEtBQzVFLEtBQUssU0FBQyxHQUNILFFBQVEsSUFBSSwwQkFBMkIsR0FDdkMsR0FBUSxLQUVYLE1BQU0sU0FBQSxHQUNILEVBQU8sT0FHbEIsTUFBTSxTQUFBLFNBS25CLGdCQUFBLFVBQUEsYUFBQSxTQUFhLEdBQWIsSUFBQSxFQUFBLEtBQ0ksT0FBTyxJQUFJLFFBQWlCLFNBQUMsRUFBUyxHQUNqQixFQUFLLG9CQUFvQixFQUFhLDBCQUVsRCxLQUFLLFNBQUEsSUFDRixFQUFBLFVBQUEs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QUFZLEdBQ3pCLEVBQVMscUJBQXFCLGVBQ3BDLEdBQUcsWUFBYyxFQUN6QixRQUFRLElBQUksNkJBQThCLEVBQVMsZ0JBQWdCLFdBQ25FLEVBQWMsRUFBWSxpQkFBaUIsR0FDM0MsRUFBUSxRQUdSLE1BR1AsTUFBTSxTQUFBLEdBRUgsRUFBTyxRQUtmLGdCQUFBLFVBQUEsd0JBQVIsU0FBZ0MsR0FJNUIsTUFIc0Isa1JBQ3VDLEVBQVMsZ0RBS2xFLGdCQUFBLFVBQUEsc0JBQVIsU0FBOEIsRUFBYSxHQUN2QyxPQUFPLElBQUksUUFBZ0IsU0FBQyxFQUFTLEdBQ2pDLElBQUksRUFBc0IsS0FDdEIsR0FBYyxFQUFBLFVBQUEsWUFBVyxhQUFBLFlBQzdCLEVBQVksV0FBVyxHQUNsQixLQUFLLFNBQUEsR0FDRixJQUFJLEVBQVcsRUFBWSxZQUFZLEdBQ3pCLEVBQVMscUJBQXFCLFdBQ3BDLEdBQUcsWUFBYyxFQUV6QixHQURBLEVBQWMsRUFBWSxpQkFBaUIsSUFDakIsUUFBUSxZQUFhLElBQy9DLFFBQVEsSUFBSSxjQUFjLEdBQzFCLEVBQVEsS0FFWCxNQUFNLFNBQUEsR0FFSCxFQUFPLFFBTXZCLGdCQUFBLFVBQUEsZUFBQSxTQUFlLEdBR29CLFNBQVMsZUFBZSxHQUFLLE9BT3JDLFNBQVMsZUFBZSxFQUFLLE9BQVEsVUFBVSxPQUFPLGFBQ3RELFNBQVMsZUFBZSxFQUFLLFNBQVUsVUFBWSxLQUxuRCxTQUFTLGVBQWUsRUFBSyxPQUFRLFVBQVUsSUFBSSxhQUNuRCxTQUFTLGVBQWUsRUFBSyxTQUFVLFVBQVksbUNBN1l2RSxnQkFBQSxhQUF1QixzREFvWmxDLGdCQXJaQSxDQUFxQyxrQkFBQSxpQkFBeEIsUUFBQSxnQkFBQSIsImZpbGUiOiJTYWJyZUNvbnRyb2xsZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJU2FicmVDb250cm9sbGVyIH0gZnJvbSBcIi4vSVNhYnJlQ29udHJvbGxlclwiO1xyXG5pbXBvcnQgeyBBYnN0cmFjdFNlcnZpY2UgfSBmcm9tIFwic2FicmUtbmd2LWFwcC9hcHAvc2VydmljZXMvaW1wbC9BYnN0cmFjdFNlcnZpY2VcIjtcclxuaW1wb3J0IHsgZ2V0U2VydmljZSwgY2YsIGNvbnRleHQgfSBmcm9tIFwiLi4vQ29udGV4dFwiO1xyXG5pbXBvcnQgeyBTYWJyZVNlcnZpY2UgfSBmcm9tIFwiLi4vc2VydmljZXMvU2FicmVTZXJ2aWNlXCI7XHJcbmltcG9ydCB7IElSZXNlcnZhdGlvblNlcnZpY2UgfSBmcm9tIFwic2FicmUtbmd2LXJlc2VydmF0aW9uL3NlcnZpY2VzL0lSZXNlcnZhdGlvblNlcnZpY2VcIjtcclxuaW1wb3J0IHsgQ29tbWFuZE1lc3NhZ2VSZXNlcnZhdGlvblJzIH0gZnJvbSBcInNhYnJlLW5ndi1wb3MtY2RtL3Jlc2VydmF0aW9uXCI7XHJcbmltcG9ydCB7IFBuclB1YmxpY1NlcnZpY2UgfSBmcm9tIFwic2FicmUtbmd2LWFwcC9hcHAvc2VydmljZXMvaW1wbC9QbnJQdWJsaWNTZXJ2aWNlXCI7XHJcbmltcG9ydCB7IEFnZW50UHJvZmlsZVNlcnZpY2UgfSBmcm9tIFwic2FicmUtbmd2LWFwcC9hcHAvc2VydmljZXMvaW1wbC9BZ2VudFByb2ZpbGVTZXJ2aWNlXCI7XHJcbmltcG9ydCB7IENvbW1hbmRNZXNzYWdlQmFzaWNScywgQ29tbWFuZE1lc3NhZ2VScSB9IGZyb20gXCJzYWJyZS1uZ3YtcG9zLWNkbS9jb21tc2dcIjtcclxuaW1wb3J0IHsgSUNvbW1hbmRNZXNzYWdlU2VydmljZSB9IGZyb20gXCJzYWJyZS1uZ3YtY29tbXNnL3NlcnZpY2VzL0lDb21tYW5kTWVzc2FnZVNlcnZpY2VcIjtcclxuaW1wb3J0IHsgVXRpbGl0YXJpbyB9IGZyb20gXCIuLi9jb21tb24vVXRpbGl0YXJpb1wiO1xyXG5pbXBvcnQgeyByZW1hcmsgfSBmcm9tIFwiLi4vbW9kZWwvcmVtYXJrXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgU2FicmVDb250cm9sbGVyIGV4dGVuZHMgQWJzdHJhY3RTZXJ2aWNlIGltcGxlbWVudHMgSVNhYnJlQ29udHJvbGxlciB7XHJcbiAgICBzdGF0aWMgU0VSVklDRV9OQU1FOiBzdHJpbmcgPSBcImNvbS1pbnRlcm5vdmEtZ3RjcGF5bWVudC13ZWItbW9kdWxlLVNhYnJlQ29udHJvbGxlclwiO1xyXG5cclxuICAgIGJ1aWxkUmVxdWVzdEdldFJlc2VydmF0aW9uKHBucjogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlPGJvb2xlYW4+KChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgICAgICAgbGV0IHJlcXVlc3QgPSB0aGlzLmJ1aWxkR2V0UmVzZXJ2YXRpb25SUShwbnIsIFwiR2V0UmVzZXJ2YXRpb25SUVwiKTtcclxuICAgICAgICAgICAgcmVxdWVzdFxyXG4gICAgICAgICAgICAgICAgLnRoZW4ocmVzcCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZ2V0U2VydmljZShTYWJyZVNlcnZpY2UpLmNhbGxTb2FwU2VydmljZUFzeW5jKHJlc3AsIFwiR2V0UmVzZXJ2YXRpb25SUVwiLCAnU0VTU0lPTicsIDEwMDAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbigocmVzb2x2ZXIpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwicmVzb2x2ZXIgR2V0UmVzZXJ2YXRpb25SUVwiLCByZXNvbHZlcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgYnVpbGRSZXF1ZXN0QWRkUmVtYXJrKGxpc3RSZW1hcmtzOiBBcnJheTxyZW1hcms+KTogUHJvbWlzZTxib29sZWFuPiB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlPGJvb2xlYW4+KChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJsaXN0UmVtYXJrcyBvbiBidWlsZFJlcXVlc3RBZGRSZW1hcmtcIiwgbGlzdFJlbWFya3MpO1xyXG5cclxuICAgICAgICAgICAgbGV0IHJlcXVlc3RSbWsgPSB0aGlzLmJ1aWxkQWRkUmVtYXJrUlEobGlzdFJlbWFya3MsIFwiQWRkUmVtYXJrTExTUlFcIik7XHJcbiAgICAgICAgICAgIHJlcXVlc3RSbWtcclxuICAgICAgICAgICAgICAgIC50aGVuKHJlc3AgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGdldFNlcnZpY2UoU2FicmVTZXJ2aWNlKS5jYWxsU29hcFNlcnZpY2VBc3luYyhyZXNwLCBcIkFkZFJlbWFya0xMU1JRXCIsICdTRVNTSU9OJywgMTAwMDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKChyZXNvbHZlcikgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJyZXNvbHZlciBBZGRSZW1hcmtMTFNSUVwiLCByZXNvbHZlcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgUmVtYXJrVXBkYXRlKGxpc3RSZW1hcmtzOiBBcnJheTxyZW1hcms+KTogUHJvbWlzZTxib29sZWFuPiB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlPGJvb2xlYW4+KChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgICAgICAgbGV0IHJlcXVlc3RSbWsgPSB0aGlzLmJ1aWxkUmVtYXJrVXBkYXRlUlEobGlzdFJlbWFya3MsIFwiVXBkYXRlUmVzZXJ2YXRpb25SUXJta1wiKTtcclxuICAgICAgICAgICAgcmVxdWVzdFJta1xyXG4gICAgICAgICAgICAgICAgLnRoZW4ocmVzcCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZ2V0U2VydmljZShTYWJyZVNlcnZpY2UpLmNhbGxTb2FwU2VydmljZUFzeW5jKHJlc3AsIFwiVXBkYXRlUmVzZXJ2YXRpb25SUVwiLCAnU0VTU0lPTicsIDEwMDAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbigocmVzb2x2ZXIpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwicmVzb2x2ZXIgVXBkYXRlUmVzZXJ2YXRpb25SUVwiLCByZXNvbHZlcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgU2VuZENvbW1hbmRBc3luYyhmb3JtYXQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZTxib29sZWFuPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwiQXN5bmMgZW50cnk6XCIsIGZvcm1hdCk7XHJcbiAgICAgICAgICAgIGxldCByZXF1ZXN0U2FicmVDb21tYW5kID0gdGhpcy5idWlsZFJlcXVlc3RTYWJyZUNvbW1hbmQoZm9ybWF0LCBcIlNhYnJlQ29tbWFuZExMU1JRXCIpO1xyXG4gICAgICAgICAgICByZXF1ZXN0U2FicmVDb21tYW5kXHJcbiAgICAgICAgICAgICAgICAudGhlbihyZXNwID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBnZXRTZXJ2aWNlKFNhYnJlU2VydmljZSkuY2FsbFNvYXBTZXJ2aWNlQXN5bmMocmVzcCwgXCJTYWJyZUNvbW1hbmRMTFNSUVwiLCAnU0VTU0lPTicsIDEwMDAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbigocmVzb2x2ZXIpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHJlc29sdmVyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUodHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGVycm9yKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgU2VuZENvbW1hbmRBc3luY1JzKGZvcm1hdDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+IHtcclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2U8c3RyaW5nPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwiQXN5bmMgZW50cnk6XCIsIGZvcm1hdCk7XHJcbiAgICAgICAgICAgIGxldCByZXF1ZXN0U2FicmVDb21tYW5kID0gdGhpcy5idWlsZFJlcXVlc3RTYWJyZUNvbW1hbmQoZm9ybWF0LCBcIlNhYnJlQ29tbWFuZExMU1JRXCIpO1xyXG4gICAgICAgICAgICByZXF1ZXN0U2FicmVDb21tYW5kXHJcbiAgICAgICAgICAgICAgICAudGhlbihyZXNwID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcInJlc3A6XCIsIHJlc3ApO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBnZXRTZXJ2aWNlKFNhYnJlU2VydmljZSkuY2FsbFNvYXBTZXJ2aWNlQXN5bmMocmVzcCwgXCJTYWJyZUNvbW1hbmRMTFNSUVwiLCAnU0VTU0lPTicsIDEwMDAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbigocmVzb2x2ZXIpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwicmVzb2x2ZXI6XCIsIHJlc29sdmVyKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgdXRpbGl0YXJpb18gPSBnZXRTZXJ2aWNlKFV0aWxpdGFyaW8pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coXCJ1dGlsaXRhcmlvXzpcIiwgdXRpbGl0YXJpb18pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkb2N1bWVudCA9IHV0aWxpdGFyaW9fLlN0cmluZ1RvWG1sKHJlc29sdmVyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwiZG9jdW1lbnQgaW4geG1sOlwiLCBkb2N1bWVudCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbW1hbmRScyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiUmVzcG9uc2VcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGNvbW1hbmRSc1swXS5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGVycm9yKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgU2VuZENvbW1hbmRTeW5jKGZvcm1hdDogc3RyaW5nKTogc3RyaW5nIHsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9zaSBubyBlc3TDoSAzNjAgbm8gbG8gZGV0ZWN0YSAgICBcclxuICAgICAgICAvLyBjb25zb2xlLmxvZygnZW50cnknLCBmb3JtYXQpXHJcbiAgICAgICAgbGV0IHJlc3BvbnNlTWVzc2FnZTogc3RyaW5nID0gbnVsbDtcclxuICAgICAgICBsZXQgcmVxdWVzdFNhYnJlQ29tbWFuZFN0cmluZyA9IHRoaXMuYnVpbGRSZXF1ZXN0U2VuZENvbW1hbmQoZm9ybWF0KTsgICAgICAgICAgICAgICAgICAgLy9sbGFtYW1vcyBhbCBtZXRvZG8gY29uIGVsIHRoaXMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKCdycScsIHJlcXVlc3RTYWJyZUNvbW1hbmRTdHJpbmcpXHJcbiAgICAgICAgaWYgKHJlcXVlc3RTYWJyZUNvbW1hbmRTdHJpbmcgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICByZXNwb25zZU1lc3NhZ2UgPSBnZXRTZXJ2aWNlKFNhYnJlU2VydmljZSkuY2FsbFNvYXBTZXJ2aWNlU3luYyhyZXF1ZXN0U2FicmVDb21tYW5kU3RyaW5nLCBcIlNhYnJlQ29tbWFuZExMU1JRXCIpXHJcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdycycsIHJlc3BvbnNlTWVzc2FnZSlcclxuICAgICAgICAgICAgaWYgKHJlc3BvbnNlTWVzc2FnZSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgcnNwQ29tbWFuZCA9IEpTT04ucGFyc2UocmVzcG9uc2VNZXNzYWdlKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vcGFyc2VhbW9zIGxhIHJlc3B1ZXN0YSBlbiB1bmEgdmFyaWFibGUgZGUgdGlwbyBKU09OICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICByZXNwb25zZU1lc3NhZ2UgPSBcIlwiO1xyXG4gICAgICAgICAgICAgICAgaWYgKHJzcENvbW1hbmQucmVzcG9uc2UgIT0gbnVsbCAmJiByc3BDb21tYW5kLnJlc3BvbnNlLnN1Y2Nlc3MpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXNwb25zZU1lc3NhZ2UgPSByc3BDb21tYW5kLnJlc3BvbnNlLnBheWxvYWQucmVzcG9uc2VUZXh0OyAgICAgICAgICAgICAgICAgLy9kZXZ1ZWx2ZSBlbCBTYWJyZUNvbW1hbmRSU1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwicmVzcG9uc2VNZXNzYWdlOlwiLHJlc3BvbnNlTWVzc2FnZSk7ICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZU1lc3NhZ2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlTWVzc2FnZTtcclxuICAgIH1cclxuXHJcbiAgICBTZW5kQ29tbWFuZE1lc3NhZ2UocGF5bG9hZDogc3RyaW5nLCBzaG93UnE6IGJvb2xlYW4sIHNob3dSczogYm9vbGVhbik6IFByb21pc2U8Q29tbWFuZE1lc3NhZ2VCYXNpY1JzPiB7XHJcbiAgICAgICAgbGV0IGlDbWRNc2dTZXJ2aWNlID0gZ2V0U2VydmljZShJQ29tbWFuZE1lc3NhZ2VTZXJ2aWNlKTtcclxuICAgICAgICByZXR1cm4gaUNtZE1zZ1NlcnZpY2Uuc2VuZCh7XHJcbiAgICAgICAgICAgIHJxOiBwYXlsb2FkLFxyXG4gICAgICAgICAgICBzaG93UnE6IHNob3dScSxcclxuICAgICAgICAgICAgc2hvd1JzOiBzaG93UnNcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICpcclxuICpcclxuICogQHByaXZhdGVcclxuICogQHBhcmFtIHtzdHJpbmd9IHJlZk5vZGVcclxuICogQHBhcmFtIHtzdHJpbmd9IHJlZkF0dHJcclxuICogQHBhcmFtIHtFbGVtZW50fSBhY3R1YWxOb2RlXHJcbiAqIEByZXR1cm4geyp9ICB7c3RyaW5nfVxyXG4gKiBAbWVtYmVyb2YgU2FicmVDb250cm9sbGVyXHJcbiAqL1xyXG4gICAgcHJpdmF0ZSBjaGVja05vZGVWYWx1ZXMocmVmTm9kZTogc3RyaW5nLCByZWZBdHRyOiBzdHJpbmcsIGFjdHVhbE5vZGU6IEVsZW1lbnQpOiBzdHJpbmcge1xyXG4gICAgICAgIGxldCBkYXRvID0gXCJcIjtcclxuICAgICAgICBpZiAoYWN0dWFsTm9kZS5sb2NhbE5hbWUgPT0gcmVmTm9kZSAmJiBhY3R1YWxOb2RlLmhhc0F0dHJpYnV0ZXMpIHtcclxuICAgICAgICAgICAgbGV0IGF0dHJpYnV0ZXMgPSBhY3R1YWxOb2RlLmF0dHJpYnV0ZXM7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBhdHRyaWJ1dGVzLmxlbmd0aDsgaW5kZXgrKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKGF0dHJpYnV0ZXNbaW5kZXhdLm5hbWUgPT0gcmVmQXR0cikge1xyXG4gICAgICAgICAgICAgICAgICAgIGRhdG8gPSBhdHRyaWJ1dGVzW2luZGV4XS52YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAvLyAvLyBjb25zb2xlLmxvZyhcInJlZlBvaW50OiBcIiArIGF0dHJpYnV0ZXNbaW5kZXhdLm5hbWUgKyBcIiAgOjogXCIgKyBhdHRyaWJ1dGVzW2luZGV4XS52YWx1ZSk7ICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBkYXRvO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbipcclxuKlxyXG4qIEBwcml2YXRlXHJcbiogQHBhcmFtIHtFbGVtZW50fSBub2RlRmF0aGVyXHJcbiogQHBhcmFtIHtzdHJpbmd9IHJlZkF0dHJcclxuKiBAcGFyYW0ge3N0cmluZ30gcmVmUG9pbnRcclxuKiBAcGFyYW0ge3N0cmluZ30gbm9kZUZhdGhlcjJcclxuKiBAcmV0dXJuIHsqfSAge3N0cmluZ1tdW119XHJcbiogQG1lbWJlcm9mIFNhYnJlQ29udHJvbGxlclxyXG4qL1xyXG4gICAgcHJpdmF0ZSBHZXRGaW5hbFZhbHVlKG5vZGVGYXRoZXI6IEVsZW1lbnQsIHJlZkF0dHI6IHN0cmluZywgcmVmUG9pbnQ6IHN0cmluZywgbm9kZUZhdGhlcjI6IHN0cmluZyk6IHN0cmluZ1tdW10ge1xyXG4gICAgICAgIGxldCBhcnJheUF0dHJzOiBzdHJpbmdbXVtdID0gbmV3IEFycmF5KCk7XHJcbiAgICAgICAgYXJyYXlBdHRycy5wdXNoKFtyZWZBdHRyLCByZWZQb2ludF0pO1xyXG4gICAgICAgIGlmIChub2RlRmF0aGVyMiA9PSBcIipcIikge1xyXG4gICAgICAgICAgICBhcnJheUF0dHJzLnB1c2goW1wic2VndHlwZVwiLCBub2RlRmF0aGVyLmxvY2FsTmFtZV0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgY2hpbGROb2RlcyA9IG5vZGVGYXRoZXIuY2hpbGROb2RlcztcclxuICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGNoaWxkTm9kZXMubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgICAgbGV0IGVsZW1lbnRfY2hpbGROb2RlcyA9IDxFbGVtZW50PmNoaWxkTm9kZXNbal07XHJcbiAgICAgICAgICAgIGlmIChlbGVtZW50X2NoaWxkTm9kZXMubG9jYWxOYW1lKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgbG9jYWxOYW1lID0gZWxlbWVudF9jaGlsZE5vZGVzLmxvY2FsTmFtZTtcclxuICAgICAgICAgICAgICAgIGxldCB2YWx1ZSA9IGVsZW1lbnRfY2hpbGROb2Rlcy50ZXh0Q29udGVudDtcclxuICAgICAgICAgICAgICAgIGFycmF5QXR0cnMucHVzaChbbG9jYWxOYW1lLCB2YWx1ZV0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIC8vIGNvbnNvbGUubG9nKFwiR2V0RmluYWxWYWx1ZTogXCIpO1xyXG4gICAgICAgIC8vIC8vIGNvbnNvbGUubG9nKGFycmF5QXR0cnMpO1xyXG4gICAgICAgIHJldHVybiBhcnJheUF0dHJzO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKlxyXG4gICAgICpcclxuICAgICogQHByaXZhdGVcclxuICAgICogQHBhcmFtIHtzdHJpbmd9IHBuckxvY2F0b3JWYWx1ZVxyXG4gICAgKiBAcGFyYW0ge3N0cmluZ30gcGF0dGVyblxyXG4gICAgKiBAcGFyYW0ge2Jvb2xlYW59IElzUmVtb3ZlTlNcclxuICAgICogQHJldHVybiB7Kn0gIHtOb2RlfVxyXG4gICAgKiBAbWVtYmVyb2YgU2FicmVDb250cm9sbGVyXHJcbiAgICAqL1xyXG4gICAgcHJpdmF0ZSBHZXRFbGVtZW50KHBuckxvY2F0b3JWYWx1ZTogc3RyaW5nLCBwYXR0ZXJuOiBzdHJpbmcsIElzUmVtb3ZlTlM6IGJvb2xlYW4pOiBOb2RlIHtcclxuICAgICAgICBsZXQgcmV0dXJuRWxlbWVudDogTm9kZSA9IG51bGw7XHJcbiAgICAgICAgaWYgKElzUmVtb3ZlTlMpIHsgcG5yTG9jYXRvclZhbHVlID0gZ2V0U2VydmljZShVdGlsaXRhcmlvKS5SZW1vdmVOYW1lU3BhY2UocG5yTG9jYXRvclZhbHVlKTsgfVxyXG4gICAgICAgIHZhciBwYXJzZXIgPSBuZXcgRE9NUGFyc2VyKCk7XHJcbiAgICAgICAgdmFyIGRvYzEgPSBwYXJzZXIucGFyc2VGcm9tU3RyaW5nKHBuckxvY2F0b3JWYWx1ZSwgXCJ0ZXh0L3htbFwiKTtcclxuICAgICAgICB2YXIgY2hpbGROb2RlcyA9IGRvYzEuY2hpbGROb2RlcztcclxuICAgICAgICBsZXQgZWxlbWVudF9jaGlsZE5vZGVzID0gPEVsZW1lbnQ+Y2hpbGROb2Rlc1swXTsgICAgLy9maXJzdCBsaW5lIG9uIFJTICAgICAgICBcclxuICAgICAgICBpZiAoZWxlbWVudF9jaGlsZE5vZGVzLmhhc0F0dHJpYnV0ZXMpIHtcclxuICAgICAgICAgICAgbGV0IGF0dHJpYnV0ZXMgPSBlbGVtZW50X2NoaWxkTm9kZXMuYXR0cmlidXRlcztcclxuICAgICAgICAgICAgbGV0IGZvdW5kID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBhdHRyaWJ1dGVzLmxlbmd0aDsgaW5kZXgrKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIHRlbXAgPSBhdHRyaWJ1dGVzW2luZGV4XS5uYW1lLnNwbGl0KFwiOlwiKTtcclxuICAgICAgICAgICAgICAgIGlmICh0ZW1wWzBdID09ICd4bWxucycgJiYgIWZvdW5kKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHhtbG5zID0gYXR0cmlidXRlc1tpbmRleF0udmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgZm91bmQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKFwieG1sbnM6IFwiICsgeG1sbnMpO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiByZXNvbHZlck5TKCk6IHN0cmluZyB7IHJldHVybiB4bWxuczsgfVxyXG4gICAgICAgIHZhciByZXN1bHQgPSBnZXRTZXJ2aWNlKFV0aWxpdGFyaW8pLkdldFhQYXRoUmVzdWx0KHBuckxvY2F0b3JWYWx1ZSwgcGF0dGVybiwgcmVzb2x2ZXJOUywgMCk7XHJcbiAgICAgICAgLy8gdmFyIHJlc3VsdCA9IGdldFNlcnZpY2UoVXRpbGl0YXJpbykuR2V0WFBhdGhSZXN1bHQoMywgcG5yTG9jYXRvclZhbHVlLCBwYXR0ZXJuLCByZXNvbHZlck5TLCAwKTtcclxuICAgICAgICByZXR1cm5FbGVtZW50ID0gcmVzdWx0Lml0ZXJhdGVOZXh0KCk7XHJcbiAgICAgICAgcmV0dXJuIHJldHVybkVsZW1lbnQ7XHJcbiAgICB9XHJcblxyXG4gICAgQWRkUmVtYXJrc0FzeW5jKHJlbWFya3M6IEFycmF5PHJlbWFyaz4pOiBQcm9taXNlPGJvb2xlYW4+IHtcclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2U8Ym9vbGVhbj4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgICAgICBsZXQgcmVxdWVzdFJlbWFyayA9IHRoaXMuYnVpbGRSZXF1ZXN0QWRkUmVtYXJrKHJlbWFya3MpO1xyXG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcInJlcXVlc3RSZW1hcms6IFwiLCByZXF1ZXN0UmVtYXJrKTtcclxuXHJcbiAgICAgICAgICAgIC8vIHJlcXVlc3RSZW1hcmtcclxuICAgICAgICAgICAgLy8gICAgIC50aGVuKHJlc3AgPT4ge1xyXG4gICAgICAgICAgICAvLyAgICAgICAgIGdldFNlcnZpY2UoU2FicmVTZXJ2aWNlKS5jYWxsU29hcFNlcnZpY2VBc3luYyhyZXNwLCBcIkFkZFJlbWFya0xMU1JRXCIsICdTRVNTSU9OJywgMTAwMDApXHJcbiAgICAgICAgICAgIC8vICAgICAgICAgICAgIC50aGVuKChyZXNvbHZlcikgPT4ge1xyXG4gICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2cocmVzb2x2ZXIpO1xyXG4gICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgcmVzb2x2ZSh0cnVlKTtcclxuICAgICAgICAgICAgLy8gICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLy8gICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHtcclxuICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgIHJlamVjdChlcnJvcik7XHJcbiAgICAgICAgICAgIC8vICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAvLyAgICAgfSlcclxuICAgICAgICAgICAgLy8gICAgIC5jYXRjaChlcnJvciA9PiB7XHJcbiAgICAgICAgICAgIC8vICAgICAgICAgLy8gY29uc29sZS5sb2coZXJyb3IpO1xyXG4gICAgICAgICAgICAvLyAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBidWlsZFJlcXVlc3RSZXNlcnZhdGlvbihhY3Rpb246IHN0cmluZyk6IFByb21pc2U8c3RyaW5nPiB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlPHN0cmluZz4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgICAgICBsZXQgdXRpbGl0YXJpb19wYXlsb2FkID0gZ2V0U2VydmljZShVdGlsaXRhcmlvKS5HZXRQYXlMb2FkKGFjdGlvbik7XHJcbiAgICAgICAgICAgIHV0aWxpdGFyaW9fcGF5bG9hZC50aGVuKHJzcCA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKHJzcCk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGVycm9yKTtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICB9KVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgYnVpbGRBZGRSZW1hcmtSUShsaXN0UmVtYXJrczogQXJyYXk8cmVtYXJrPiwgYWN0aW9uOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZz4ge1xyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZTxzdHJpbmc+KChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgICAgICAgbGV0IHJldHVyblZhbHVlOiBzdHJpbmcgPSBudWxsO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcImxpc3RSZW1hcmtzIG9uIGJ1aWxkQWRkUmVtYXJrUlFcIiwgbGlzdFJlbWFya3MpO1xyXG4gICAgICAgICAgICBsZXQgdXRpbGl0YXJpb18gPSBnZXRTZXJ2aWNlKFV0aWxpdGFyaW8pO1xyXG4gICAgICAgICAgICB1dGlsaXRhcmlvXy5HZXRQYXlMb2FkKGFjdGlvbilcclxuICAgICAgICAgICAgICAgIC50aGVuKHJzcCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRvY3VtZW50ID0gdXRpbGl0YXJpb18uU3RyaW5nVG9YbWwocnNwKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlN0cmluZ1RvWG1sXCIsIGRvY3VtZW50KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcIlJlbWFya0luZm9cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGxpc3RSZW1hcmtzICE9IG51bGwgJiYgbGlzdFJlbWFya3MubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBybWsgb2YgbGlzdFJlbWFya3MpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwicm1rXCIsIHJtayk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGVsZW1lbnRfdmFyID0gZWxlbWVudFswXS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiUmVtYXJrXCIpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnRfdmFyLnNldEF0dHJpYnV0ZShcIlR5cGVcIiwgcm1rLlR5cGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJtay5Db2RlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudF92YXIuc2V0QXR0cmlidXRlKFwiQ29kZVwiLCBybWsuQ29kZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocm1rLlNlZ051bSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnRfdmFyLnNldEF0dHJpYnV0ZShcIlNlZ21lbnROdW1iZXJcIiwgcm1rLlNlZ051bSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgdGV4dCA9IGVsZW1lbnRfdmFyLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ1RleHQnKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0LnRleHRDb250ZW50ID0gcm1rLlRleHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuVmFsdWUgPSB1dGlsaXRhcmlvXy5Eb2N1bWVudFRvU3RyaW5nKGRvY3VtZW50KTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm5WYWx1ZSA9IHJldHVyblZhbHVlLnJlcGxhY2UoL3htbG5zPVwiXCIvZywgJycpXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXR1cm5WYWx1ZSk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcImVycm9yIGJ1aWxkQ3JlYXRlUmVzZXJ2YXRpb25SUTpcIiwgZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnJvcik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9KVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgYnVpbGRSZW1hcmtVcGRhdGVSUShsaXN0UmVtYXJrczogQXJyYXk8cmVtYXJrPiwgYWN0aW9uOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZz4ge1xyXG5cclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2U8c3RyaW5nPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgIGxldCByZXR1cm5WYWx1ZTogc3RyaW5nID0gbnVsbDtcclxuICAgICAgICAgICAgbGV0IHV0aWxpdGFyaW9fID0gZ2V0U2VydmljZShVdGlsaXRhcmlvKTtcclxuICAgICAgICAgICAgdXRpbGl0YXJpb18uR2V0UGF5TG9hZChhY3Rpb24pXHJcbiAgICAgICAgICAgICAgICAudGhlbihyc3AgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBkb2N1bWVudCA9IHV0aWxpdGFyaW9fLlN0cmluZ1RvWG1sKHJzcCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcIlJlc2VydmF0aW9uVXBkYXRlSXRlbVwiKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobGlzdFJlbWFya3MgIT0gbnVsbCAmJiBsaXN0UmVtYXJrcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IHJtayBvZiBsaXN0UmVtYXJrcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGVsZW1lbnRfdmFyID0gZWxlbWVudFswXS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiUmVtYXJrVXBkYXRlXCIpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnRfdmFyLnNldEF0dHJpYnV0ZShcImlkXCIsIHJtay5JZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50X3Zhci5zZXRBdHRyaWJ1dGUoXCJ0eXBlXCIsIFwiSU5WT0lDRVwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnRfdmFyLnNldEF0dHJpYnV0ZShcIm9wXCIsIFwiVVwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCB0ZXh0ID0gZWxlbWVudF92YXIuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnUmVtYXJrVGV4dCcpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQudGV4dENvbnRlbnQgPSBybWsuVGV4dDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm5WYWx1ZSA9IHV0aWxpdGFyaW9fLkRvY3VtZW50VG9TdHJpbmcoZG9jdW1lbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVyblZhbHVlID0gcmV0dXJuVmFsdWUucmVwbGFjZSgveG1sbnM9XCJcIi9nLCAnJylcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJldHVyblZhbHVlKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwiZXJyb3IgYnVpbGRDcmVhdGVSZXNlcnZhdGlvblJROlwiLCBlcnJvcik7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBidWlsZFJlcXVlc3RTYWJyZUNvbW1hbmQoZm9ybWF0OiBzdHJpbmcsIGFjdGlvbjogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+IHtcclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2U8c3RyaW5nPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgIGxldCByZXR1cm5WYWx1ZTogc3RyaW5nID0gbnVsbDtcclxuICAgICAgICAgICAgbGV0IHV0aWxpdGFyaW9fID0gZ2V0U2VydmljZShVdGlsaXRhcmlvKTtcclxuICAgICAgICAgICAgdXRpbGl0YXJpb18uR2V0UGF5TG9hZChhY3Rpb24pXHJcbiAgICAgICAgICAgICAgICAudGhlbihyc3AgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChmb3JtYXQgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZG9jdW1lbnQgPSB1dGlsaXRhcmlvXy5TdHJpbmdUb1htbChyc3ApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiSG9zdENvbW1hbmRcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnRbMF0udGV4dENvbnRlbnQgPSBmb3JtYXQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwicmVzb2x2ZXIgZGVzcHVlcyBjb252ZXJ0aXJcIiwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmlubmVySFRNTCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVyblZhbHVlID0gdXRpbGl0YXJpb18uRG9jdW1lbnRUb1N0cmluZyhkb2N1bWVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmV0dXJuVmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KClcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhlcnJvcik7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBidWlsZFJlcXVlc3RTZW5kQ29tbWFuZChmb3JtYXQ6IHN0cmluZyk6IHN0cmluZyB7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE1ldG9kbyAgICAvL2VzdHJ1Y3R1cmEgZGUgcmVxdWVzdCBkZWwgc2FicmUgY29tbWFuZCAgXHJcbiAgICAgICAgbGV0IHJlcXVlc3Q6IHN0cmluZyA9ICc8U2FicmVDb21tYW5kTExTUlEgeG1sbnM9XCJodHRwOi8vd2Vic2VydmljZXMuc2FicmUuY29tL3NhYnJlWE1MLzIwMDMvMDdcIiB4bWxuczp4cz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hXCIgeG1sbnM6eHNpPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEtaW5zdGFuY2VcIiBUaW1lU3RhbXA9XCIyMDE0LTAzLTA0VDE0OjAwOjAwXCIgVmVyc2lvbj1cIjEuOC4xXCI+JyArXHJcbiAgICAgICAgICAgICc8UmVxdWVzdCBPdXRwdXQ9XCJTQ1JFRU5cIiBDREFUQT1cImZhbHNlXCI+PEhvc3RDb21tYW5kPicgKyBmb3JtYXQgKyAnPC9Ib3N0Q29tbWFuZD48L1JlcXVlc3Q+JyArXHJcbiAgICAgICAgICAgICc8L1NhYnJlQ29tbWFuZExMU1JRPic7XHJcbiAgICAgICAgcmV0dXJuIHJlcXVlc3Q7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBidWlsZEdldFJlc2VydmF0aW9uUlEocG5yOiBzdHJpbmcsIGFjdGlvbjogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+IHtcclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2U8c3RyaW5nPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgIGxldCByZXR1cm5WYWx1ZTogc3RyaW5nID0gbnVsbDtcclxuICAgICAgICAgICAgbGV0IHV0aWxpdGFyaW9fID0gZ2V0U2VydmljZShVdGlsaXRhcmlvKTtcclxuICAgICAgICAgICAgdXRpbGl0YXJpb18uR2V0UGF5TG9hZChhY3Rpb24pXHJcbiAgICAgICAgICAgICAgICAudGhlbihyc3AgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBkb2N1bWVudCA9IHV0aWxpdGFyaW9fLlN0cmluZ1RvWG1sKHJzcCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcIkxvY2F0b3JcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudFswXS50ZXh0Q29udGVudCA9IHBucjtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm5WYWx1ZSA9IHV0aWxpdGFyaW9fLkRvY3VtZW50VG9TdHJpbmcoZG9jdW1lbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVyblZhbHVlID0gcmV0dXJuVmFsdWUucmVwbGFjZSgveG1sbnM9XCJcIi9nLCAnJylcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcInJldHVyblZhbHVlXCIscmV0dXJuVmFsdWUpOyAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXR1cm5WYWx1ZSk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcImVycm9yIGJ1aWxkQ3JlYXRlUmVzZXJ2YXRpb25SUTpcIiwgZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnJvcik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9KVxyXG4gICAgfVxyXG5cclxuICAgIC8vdG8gdmFsaWRhdGUgZXZlcnkgaW5wdXQgYW5kIGVycm9yIGlmIG5lZWRlZFxyXG4gICAgSW5wdXRWYWxpZGF0b3IoaWQ6IHN0cmluZyk6IHZvaWQge1xyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKFwiaWQgcXVlIHZhIGEgdmFsb3JhciBzaSBlc3RhIGVtcHR5OiBcIixpZCk7XHJcblxyXG4gICAgICAgIGxldCB2YWx1ZSA9ICg8SFRNTElucHV0RWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCkpLnZhbHVlO1xyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKFwidmFsdWU6IFwiLCB2YWx1ZSk7ICAgICAgICBcclxuICAgICAgICBpZiAoIXZhbHVlKSB7XHJcbiAgICAgICAgICAgICg8SFRNTElucHV0RWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCArIFwiRGl2XCIpKS5jbGFzc0xpc3QuYWRkKFwiaGFzLWVycm9yXCIpO1xyXG4gICAgICAgICAgICAoPEhUTUxJbnB1dEVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQgKyBcIkVycm9yXCIpKS5pbm5lclRleHQgPSBcIkZpZWxkIGNhbm5vdCBiZSBlbXB0eSBvciBibGFua1wiO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgKDxIVE1MSW5wdXRFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkICsgXCJEaXZcIikpLmNsYXNzTGlzdC5yZW1vdmUoXCJoYXMtZXJyb3JcIik7XHJcbiAgICAgICAgICAgICg8SFRNTElucHV0RWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCArIFwiRXJyb3JcIikpLmlubmVyVGV4dCA9IFwiXCI7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiJdLCJzb3VyY2VSb290IjoiIn0= 